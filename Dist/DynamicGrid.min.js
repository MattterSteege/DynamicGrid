/**
 * DynamicGrid is a library for rendering data in a grid format with dynamic querying capabilities.
 * @author Matt ter Steege (Kronk)
 * @license MIT
 * @version 1.4.3
 */
class EventEmitter{constructor(){this.events={}}subscribe(e,t){return this.events[e.toLocaleLowerCase()]||(this.events[e.toLocaleLowerCase()]=[]),this.events[e.toLocaleLowerCase()].push(t),()=>this.unsubscribe(e,t)}on=this.subscribe;unsubscribe(e,t){this.events[e.toLocaleLowerCase()]&&(this.events[e.toLocaleLowerCase()]=this.events[e.toLocaleLowerCase()].filter((e=>e!==t)))}off=this.unsubscribe;emit(e,t){this.events[e.toLocaleLowerCase()]&&this.events[e.toLocaleLowerCase()].forEach((e=>e(t)))}removeAllListeners(){this.events={}}}class KeyboardShortcuts{constructor(){this.shortcuts=new Map,this.listener=this.#e.bind(this),document.addEventListener("keydown",this.listener)}#t(e){return e.toLowerCase().replace(/\s+/g,"")}#e(e){const t=this.#t(`${e.ctrlKey?"ctrl+":""}${e.shiftKey?"shift+":""}${e.altKey?"alt+":""}${e.metaKey?"meta+":""}${e.key}`),n=this.shortcuts.get(t);n&&(e.preventDefault(),n(e))}addShortcut(e,t,n){const r=this.#t(e);this.shortcuts.has(r)?console.warn(`Shortcut '${e}' is already assigned.`):this.shortcuts.set(r,n)}removeShortcut(e){const t=this.#t(e);this.shortcuts.has(t)?this.shortcuts.delete(t):console.warn(`Shortcut '${e}' does not exist.`)}listShortcuts(){return Array.from(this.shortcuts.keys())}clearShortcuts(){this.shortcuts.clear()}destroy(){document.removeEventListener("keydown",this.listener),this.clearShortcuts()}}class ExportConnector{constructor(){this.name="ExportConnector",this.mimeType="application/octet-stream",this.extension="bin"}export(e,t,n){throw new Error("Export or ExportAsync method not implemented")}exportAsync(e,t,n){throw new Error("ExportAsync or Export method not implemented")}_isMethodOverridden(e){let t=Object.getPrototypeOf(this);for(;t&&t!==ExportConnector.prototype;){if(t.hasOwnProperty(e))return!0;t=Object.getPrototypeOf(t)}return!1}async smartExport(e,t,n){const r=this._isMethodOverridden("export"),i=this._isMethodOverridden("exportAsync");if(r&&i)return this.export(e,t,n);if(r)return this.export(e,t,n);if(i)return await this.exportAsync(e,t,n);throw new Error("No export method implemented in subclass")}}class GridError extends Error{constructor(e){super(e),this.name="GridError",this.stack=""}}function FastHash(e){const t=JSON.stringify(e);let n=0;for(let e=0;e<t.length;e++)n=(n<<5)-n+t.charCodeAt(e),n|=0;return n}function findMatchingIndexKey(e,t,n){const r=e=>{let t=e;if(n.SymbolsToIgnore?.length){const e=new RegExp(`[${n.SymbolsToIgnore.join("").replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}]`,"g");t=t.replace(e,"")}return n.useStrictCase?t:t.toLowerCase()},i=r(t);return e.find((e=>r(e)===i))}function firstItem(e){return!(!e||"object"!=typeof e)&&(Array.isArray(e)?e[0]:e[Object.keys(e)[0]])}async function waitState(){return new Promise((e=>{let t=setInterval((function(){1==o.state&&(clearInterval(t),e(o.state))}),1e3)}))}Array.prototype.remove=function(e){const t=this.indexOf(e);return t>-1&&this.splice(t,1),this},Number.prototype.padLeft=function(e,t){let n=String(this);for(;n.length<e;)n=t+n;return n};class ColumnHeaderContextMenu{constructor(e,t,n){this.contextMenu=e,this.engine=t,this.ui=n,this.operatorLabels={"==":"Equals","!=":"Not Equals",">":"Greater Than","<":"Less Than",">=":"Greater Than or Equal","<=":"Less Than or Equal","%=":"Starts With","=%":"Ends With","*=":"Contains","!*=":"Does Not Contain","><":"Between"}}showForColumn(e,t,n,r){const i=this.engine.getHeader(e),o=i.plugin||this.engine.getPlugin(e);return this.contextMenu.clear(),this._addColumnActions(e,i),this.contextMenu.separator(),o.getContextMenuItems(e,this.engine,this.ui).forEach((t=>{this._addPluginMenuItem(t,e,o)})),this.contextMenu.showAt(n,r)}_addPluginMenuItem(e,t,n){switch(e.type){case"filter":this._addFilterOptions(t,n,e.operators);break;case"sort":this._addSortingOptions(t,n,e.sortingHint);break;case"action":this.contextMenu.button(e.label,e.action,{icon:e.icon});break;case"custom":e.render&&e.render(this.contextMenu);break;default:console.warn(`Unknown menu item type: ${e.type} for column: ${t}`)}}_addColumnActions(e,t){this.contextMenu.button("Toggle Column",(()=>{const t=this.engine.getColumns().indexOf(e);this.ui.toggleColumn(t)}),{}),t.config.resizable&&this.contextMenu.button("Auto-fit Width",(()=>{const t=this.engine.getColumns().indexOf(e),n=this.ui.approximateColumnWidth(e);this.ui.setWidth(t,n)}),{})}_addFilterOptions(e,t,n){var r="==";this.contextMenu.submenu("Filter",(t=>{t.dropdown("filter",n.map((e=>({label:this.operatorLabels[e]||e,value:e}))),{value:r,onChange:e=>{r=e},id:"dropdown-id"}).input("Filter",{placeholder:"Filter",onChange:t=>{this.engine.setSelect(e,r,t),this.ui.render(this.engine.runCurrentQuery())},showWhen:{elementId:"dropdown-id",value:["==","!=",">","<",">=","<=","%=","=%","*=","!*="]}}).doubleInput("From","To",{placeholder:"From",placeholder_2:"To",onChange:({left:t,right:n})=>{""===t||""===n||null===t||null===n||void 0===t||void 0===n?this.engine.removeSelect(e)&&this.ui.render(this.engine.runCurrentQuery()):(this.engine.setSelect(e,">=",t),this.engine.addSelect(e,"<=",n),this.ui.render(this.engine.runCurrentQuery()))},showWhen:{elementId:"dropdown-id",value:["><"]}}).separator().button("Clear Filter",(()=>this.engine.removeSelect(e)?this.ui.render(this.engine.runCurrentQuery()):null),{})}))}_addSortingOptions(e,t,n){this.contextMenu.separator().button("Sort Ascending",(()=>this._sortColumn(e,"asc",n)),{}).button("Sort Descending",(()=>this._sortColumn(e,"desc",n)),{}).separator().button("Clear Sort",(()=>this._clearSort()),{})}_applyFilter(e,t,n){this.engine.setSelect(e,t,n),this.ui.render(this.engine.runCurrentQuery())}_clearColumnFilter(e){this.engine.removeSelect(e),this.ui.render(this.engine.runCurrentQuery())}_sortColumn(e,t){this.engine.setSort(e,t),this.ui.render(this.engine.runCurrentQuery())}_clearSort(){this.engine.removeSort(),this.ui.render(this.engine.runCurrentQuery())}_toggleColumnsVisibility(e){this.engine.getColumns().forEach(((t,n)=>{e.includes(t)?this.ui._showColumn(n):this.ui._hideColumn(n)}))}_isColumnVisible(e){const t=this.engine.getColumns().indexOf(e),n=this.ui.colGroup1?.children[t+1];return!n||"collapse"!==n.style.visibility}_createDefaultInput(e){const t=document.createElement("input");return t.type="text",t.value=e||"",t}_getInputValue(e){return"checkbox"===e.type?e.checked:e.value}}class ContextMenu{static ITEM_TYPES={BUTTON:"button",SEPARATOR:"separator",SUBMENU:"submenu",INPUT:"input",DOUBLE_INPUT:"double-input",DROPDOWN:"dropdown",CHECKBOX:"checkbox",RADIO:"radio",SEARCH_SELECT:"search-select"};static CLASSNAMES={BUTTON:"context-menu-button",SUBMENU:"context-menu-submenu",SEPARATOR:"context-menu-separator",MENU:"context-menu",INPUT:"context-menu-input",DOUBLE_INPUT:"context-menu-double-input",DROPDOWN:"context-menu-dropdown",CHECKBOX:"context-menu-checkbox",RADIO:"context-menu-radio",CONTAINER:"context-menu-container",SEARCH_SELECT:"context-menu-search-select",ICON:"context-menu-icon",LABEL:"context-menu-label"};constructor(e={}){this.options={width:e.width||200,animation:{enabled:e.animation?.enabled??!0,duration:e.animation?.duration||200,timing:e.animation?.timing||"ease-out"},position:{xOffset:e.position?.xOffset||0,yOffset:e.position?.yOffset||0},icons:e.icons||{submenu:"❯"},style:{backgroundColor:e.style?.backgroundColor||"#ffffff",textColor:e.style?.textColor||"#333333",backgroundHoverColor:e.style?.backgroundHoverColor||"#f0f0f0",border:e.style?.border||"rgba(0, 0, 0, 0.08)",shadow:e.style?.shadow||"0 10px 25px rgba(0, 0, 0, 0.1)",accent:e.style?.accent||"#3b82f6",separator:e.style?.separator||"rgba(0, 0, 0, 0.08)",padding:e.style?.padding||"10px",paddingHorizontal:e.style?.paddingHorizontal||"15px",gap:e.style?.gap||"10px",borderRadius:e.style?.borderRadius||"8px",borderRadiusInput:e.style?.borderRadiusInput||"4px",fontSize:e.style?.fontSize||"14px",transition:e.style?.transition||"0.2s",transitionFast:e.style?.transitionFast||"0.1s",transitionInput:e.style?.transitionInput||"0.2s"},indentLevel:e.indentLevel||0,isRoot:void 0===e.isRoot,closeOnClick:e.closeOnClick,closeOnOutsideClick:e.closeOnOutsideClick},this.items=[],this.id=this.#n(),this.installStyles()}addItem(e,t){const n={id:(t?.id??this.#n())+"",type:e,position:this.items.length,...t};return void 0===n.id&&(n.id=this.#n()),n.type===ContextMenu.ITEM_TYPES.SUBMENU&&(n.submenu.options.indentLevel=(this.options.indentLevel||0)+1),this.#r(n),this.items.push(n),this}button(e,t,n={}){return this.addItem(ContextMenu.ITEM_TYPES.BUTTON,{text:e,action:t,icon:n.icon,ficon:n.ficon,disabled:n.disabled,marked:n.marked,showWhen:n.showWhen,id:n.id})}input(e,t={}){return this.addItem(ContextMenu.ITEM_TYPES.INPUT,{label:e,placeholder:t.placeholder,value:t.value,onChange:t.onChange,showWhen:t.showWhen,id:t.id})}doubleInput(e,t,n={}){return this.addItem(ContextMenu.ITEM_TYPES.DOUBLE_INPUT,{label:e,label_2:t,placeholder:n.placeholder,placeholder_2:n.placeholder_2,value:n.value,value_2:n.value_2,onChange:n.onChange,showWhen:n.showWhen,id:n.id})}dropdown(e,t,n={}){return this.addItem(ContextMenu.ITEM_TYPES.DROPDOWN,{label:e,options:t,value:n.value,onChange:n.onChange,multiSelect:n.multiSelect,showWhen:n.showWhen,id:n.id})}checkbox(e,t={}){return this.addItem(ContextMenu.ITEM_TYPES.CHECKBOX,{text:e,checked:t.checked||!1,onChange:t.onChange,showWhen:t.showWhen,id:t.id})}radioGroup(e,t,n={}){return t.forEach((t=>{this.addItem(ContextMenu.ITEM_TYPES.RADIO,{label:t.label,value:t.value,name:e,checked:t.checked,onChange:n.onChange,showWhen:n.showWhen,id:n.id})})),this}separator(){return this.addItem(ContextMenu.ITEM_TYPES.SEPARATOR,{})}submenu(e,t,n={}){const r={...this.options,isRoot:!1,indentLevel:(this.options.indentLevel||0)+1,showWhen:n.showWhen,id:n.id},i=new ContextMenu(r);t(i);const o=this.addItem(ContextMenu.ITEM_TYPES.SUBMENU,{text:e,submenu:i,icon:n.icon,ficon:n.ficon,showWhen:n.showWhen,id:n.id}).items;return o[o.length-1].id=i.id,this}searchSelect(e,t,n={}){return this.addItem(ContextMenu.ITEM_TYPES.SEARCH_SELECT,{label:e,options:t,value:n.value,onChange:n.onChange,showWhen:n.showWhen,id:n.id})}showAt(e,t,n=!0){const r=this.#i();return document.getElementById(this.id)&&document.getElementById(this.id).remove(),n&&document.body.appendChild(r),this.#o(r),this.#s(r,{x:e,y:t,position:"fixed"}),this.#a(r),r}destroy(){const e=document.querySelector("body > ."+ContextMenu.CLASSNAMES.MENU);e&&e.remove();const{handleClick:t,handleContextMenu:n,handleMouseOver:r}=this._eventHandlers||{};t&&document.removeEventListener("click",t),n&&document.removeEventListener("contextmenu",n),r&&document.removeEventListener("mouseover",r),this?.clear()}clear(){this.items=[];const e=document.getElementById(this.id);e&&(e.innerHTML="")}#o(e){const t=e=>{const t=e.target;if(t.className===ContextMenu.CLASSNAMES.MENU)return void t.remove();const n=document.getElementById(t.dataset?.submenuId),r=t.matches(":hover"),i=n?.matches(":hover");r||i||n?.remove()};e.addEventListener("click",(e=>{if(!(e.target.classList.contains(ContextMenu.CLASSNAMES.DROPDOWN)||e.target.classList.contains(ContextMenu.CLASSNAMES.INPUT)||e.target.classList.contains(ContextMenu.CLASSNAMES.CHECKBOX)||e.target.classList.contains(ContextMenu.CLASSNAMES.RADIO)||e.target.classList.contains(ContextMenu.CLASSNAMES.SEARCH_SELECT))){if(e.target.classList.contains(ContextMenu.CLASSNAMES.BUTTON)){const t=this.items.find((t=>t.id===e.target.id));t&&(t.action(),this.destroy())}if(!e.target.closest("."+ContextMenu.CLASSNAMES.MENU)){if(!this.options.closeOnOutsideClick)return;this.destroy()}}})),e.addEventListener("mouseover",(e=>{if(e.target.classList.contains(ContextMenu.CLASSNAMES.SUBMENU)){const n=this.items.find((t=>t.id===e.target.dataset.submenuId));if(n){if(e.target.parentElement.querySelector("#"+n.submenu.id))return;const r=n.submenu.#i();n.submenu.#o(r),n.submenu.#s(r,{x:e.target.getBoundingClientRect().right,y:e.target.getBoundingClientRect().top}),r.style.position="absolute",r.style.left=this.options.width+"px",r.style.top=e.target.getBoundingClientRect().top-e.target.parentElement.getBoundingClientRect().top+"px",e.target.parentElement.appendChild(r),r.addEventListener("mouseleave",t),e.target.addEventListener("mouseleave",t)}}})),addEventListener("click",(e=>{e.target.closest("."+ContextMenu.CLASSNAMES.MENU)||this.options.closeOnOutsideClick&&this.destroy()}))}#r(e){const t=Object.values(ContextMenu.ITEM_TYPES);if(!e.type||!t.includes(e.type))throw new Error(`Invalid item type: ${e.type}. Allowed types are: ${t.join(", ")}`);switch(e.type){case ContextMenu.ITEM_TYPES.BUTTON:if(!e.text||"string"!=typeof e.text)throw new Error('Button item must have a "text" property of type string.');if(e.action&&"function"!=typeof e.action)throw new Error("Button item action must be a function.");break;case ContextMenu.ITEM_TYPES.SEPARATOR:break;case ContextMenu.ITEM_TYPES.SUBMENU:if(!(e.submenu&&e.submenu instanceof ContextMenu))throw new Error('Submenu item must have a "submenu" property that is an instance of ContextMenu.');break;case ContextMenu.ITEM_TYPES.INPUT:if(!e.label||"string"!=typeof e.label)throw new Error('Input item must have a "label" property of type string.');break;case ContextMenu.ITEM_TYPES.DOUBLE_INPUT:if(!e.label||"string"!=typeof e.label)throw new Error('DoubleInput item must have a "label" property of type string.');if(!e.label_2||"string"!=typeof e.label_2)throw new Error('DoubleInput item must have a "label_2" property of type string.');break;case ContextMenu.ITEM_TYPES.DROPDOWN:if(!e.label||"string"!=typeof e.label)throw new Error('Dropdown item must have a "label" property of type string.');if(!Array.isArray(e.options)||0===e.options.length)throw new Error('Dropdown item must have a non-empty "options" array.');break;case ContextMenu.ITEM_TYPES.CHECKBOX:if(!e.text||"string"!=typeof e.text)throw new Error('Checkbox item must have a "text" property of type string.');if("boolean"!=typeof e.checked)throw new Error('Checkbox item must have a "checked" property of type boolean.');break;case ContextMenu.ITEM_TYPES.RADIO:if(!e.label||"string"!=typeof e.label)throw new Error('Radio item must have a "label" property of type string.');if(!e.name||"string"!=typeof e.name)throw new Error('Radio item must have a "name" property of type string.');break;case ContextMenu.ITEM_TYPES.SEARCH_SELECT:if(!e.label||"string"!=typeof e.label)throw new Error('SearchSelect item must have a "label" property of type string.');if(!Array.isArray(e.options)||0===e.options.length)throw new Error('SearchSelect item must have a non-empty "options" array.');break;default:throw new Error(`Unhandled item type: ${e.type}`)}}#n(){return"_"+Math.random().toString(36).substring(2,9)}#i(){const e=document.createElement("div");return e.classList.add(ContextMenu.CLASSNAMES.MENU),e.id=this.id,e.setAttribute("role","menu"),e.setAttribute("aria-orientation","vertical"),e.style.width=`${this.options.width}px`,e.dataset.indent=this.options.indentLevel,this.items.forEach(((t,n)=>{let r;switch(t.type){case ContextMenu.ITEM_TYPES.BUTTON:r=this.#l(t);break;case ContextMenu.ITEM_TYPES.SEPARATOR:n<this.items.length-1&&(r=this.#c());break;case ContextMenu.ITEM_TYPES.SUBMENU:r=this.#d(t);break;case ContextMenu.ITEM_TYPES.INPUT:r=this.#u(t);break;case ContextMenu.ITEM_TYPES.DOUBLE_INPUT:r=this.#h(t);break;case ContextMenu.ITEM_TYPES.DROPDOWN:r=this.#p(t);break;case ContextMenu.ITEM_TYPES.CHECKBOX:r=this.#m(t);break;case ContextMenu.ITEM_TYPES.RADIO:r=this.#g(t);break;case ContextMenu.ITEM_TYPES.SEARCH_SELECT:r=this.#y(t);break;default:console.warn(`Unknown item type: ${t.type}`)}r&&e.appendChild(r),setTimeout((()=>{if(t.showWhen){const{elementId:e,value:n}=t.showWhen,i=document.querySelector("#"+e);if(i){const e=()=>{const e=n.includes(i.value);r.style.display=e?"":"none"};i.addEventListener("input",e),i.addEventListener("change",e),e()}}}),0)})),e}#l(e){const t=document.createElement("button");if(t.classList.add(ContextMenu.CLASSNAMES.BUTTON),t.id=e.id,t.innerText=e.text,t.disabled=e.disabled||!1,t.dataset.marked=e.marked||!1,e.icon){const n=document.createElement("span");n.innerText=e.icon,t.prepend(n)}if(e.ficon){const n=document.createElement("i");n.className=e.ficon,t.append(n)}return t}#c(){const e=document.createElement("div");return e.classList.add(ContextMenu.CLASSNAMES.SEPARATOR),e}#d(e){const t=document.createElement("button");if(t.classList.add(ContextMenu.CLASSNAMES.SUBMENU),t.innerText=e.text,t.setAttribute("aria-haspopup","true"),t.dataset.submenuId=e.id,e.icon){const n=document.createElement("span");n.innerText=e.icon,t.prepend(n)}const n=document.createElement("span");if(n.innerText=this.options.icons.submenu,n.style.marginLeft="auto",t.append(n),e.ficon){const n=document.createElement("i");n.className=e.ficon,t.append(n)}return t}#u(e){const t=document.createElement("div");t.classList.add(ContextMenu.CLASSNAMES.INPUT);const n=document.createElement("input");return n.type=e.type||"text",n.placeholder=e.placeholder||"",n.value=e.value||"",n.oninput=t=>e.onChange?.(t.target.value),n.id=e.id,t.appendChild(n),t}#h(e){const t=document.createElement("div");t.classList.add(ContextMenu.CLASSNAMES.DOUBLE_INPUT),t.id=e.id;var n={left:e.value||"",right:e.value_2||""};const r=()=>{(""===n.left&&null===n.left||void 0===n.left)&&(""===n.right&&null===n.right||void 0===n.right)?e.onChange?.({left:void 0,right:void 0}):e.onChange?.(n)},i=this.#u({type:"text",placeholder:e.placeholder||"",value:e.value||"",onChange:e=>{n.left=e,r()},id:e.id+"-1"}),o=this.#u({type:"text",placeholder:e.placeholder_2||"",value:e.value_2||"",onChange:e=>{n.right=e,r()},id:e.id+"-2"});return t.appendChild(i),t.appendChild(o),t}#p(e){const t=document.createElement("select");return t.classList.add(ContextMenu.CLASSNAMES.DROPDOWN),t.id=e.id,e.options.forEach((n=>{const r=document.createElement("option");r.value=n.value,r.textContent=n.label,n.value===e.value&&(r.selected=!0),t.appendChild(r)})),t.onchange=t=>e.onChange?.(t.target.value),t}#m(e){const t=document.createElement("label");t.classList.add(ContextMenu.CLASSNAMES.CHECKBOX);const n=document.createElement("input");n.type="checkbox",n.checked=e.checked||!1,n.onchange=t=>e.onChange?.(t.target.checked),n.id=e.id;const r=document.createElement("span");return r.textContent=e.text,t.appendChild(n),t.appendChild(r),t}#g(e){const t=document.createElement("label");t.classList.add(ContextMenu.CLASSNAMES.RADIO);const n=document.createElement("input");n.type="radio",n.name=e.name,n.value=e.value,n.checked=e.checked||!1,n.onchange=t=>e.onChange?.(t.target.value),n.id=e.id;const r=document.createElement("span");return r.textContent=e.label,t.appendChild(n),t.appendChild(r),t}#y(e){const t=document.createElement("div");t.classList.add(ContextMenu.CLASSNAMES.SEARCH_SELECT),t.id=e.id;const n=document.createElement("input");n.type="text",n.placeholder=e.label||"";const r=document.createElement("div");r.classList.add(ContextMenu.CLASSNAMES.SEARCH_SELECT+"-list");const i=document.createElement("button");return i.textContent="Toggle All",i.onclick=n=>{const i=r.querySelectorAll('input[type="checkbox"]'),o=Array.from(i).every((e=>e.checked));i.forEach((e=>{e.checked=!o}));const s=Array.from(r.querySelectorAll('input[type="checkbox"]:checked')).map((e=>e.value));e.onChange?.(s),t.value=s},r.appendChild(i),e.options.forEach((n=>{const i=document.createElement("input");i.type="checkbox",i.value=n.value,i.checked=n.checked||!1,i.onchange=n=>{const i=Array.from(r.querySelectorAll('input[type="checkbox"]:checked')).map((e=>e.value));e.onChange?.(i),t.value=i};const o=document.createElement("label");o.textContent=n.label,o.appendChild(i),r.appendChild(o)})),t.appendChild(n),t.appendChild(r),n.oninput=e=>{const t=e.target.value.toLowerCase();r.querySelectorAll("label").forEach((e=>{const n=e.textContent.toLowerCase();e.style.display=n.includes(t)?"block":"none"}))},t}#s(e,t){const{x:n,y:r}=t,{xOffset:i,yOffset:o}=this.options.position;e.style.left=`${n+i||this.options.width}px`,e.style.top=`${r+o}px`,e.style.position="fixed"}#a(e){this.options.animation.enabled&&(e.style.opacity=0,e.style.transform="scale(0.9)",e.style.transition=`opacity ${this.options.animation.duration}ms ${this.options.animation.timing},transform ${this.options.animation.duration}ms ${this.options.animation.timing}`,requestAnimationFrame((()=>{e.style.opacity=1,e.style.transform="scale(1)"})))}installStyles(){if(document.getElementById("context-menu-styles"))return;const e=document.createElement("style");e.id="context-menu-styles",e.textContent=":root {--context-menu-bg:"+(this.options.style.backgroundColor||"#ffffff")+";--context-menu-text:"+(this.options.style.textColor||"#333333")+";--context-menu-hover-bg:"+(this.options.style.backgroundHoverColor||"#f0f0f0")+";--context-menu-border:"+(this.options.style.border||"rgba(0, 0, 0, 0.08)")+";--context-menu-shadow:"+(this.options.style.shadow||"0 10px 25px rgba(0, 0, 0, 0.1)")+";--context-menu-accent:"+(this.options.style.accent||"#3b82f6")+";--context-menu-separator:"+(this.options.style.separator||"rgba(0, 0, 0, 0.08)")+";--padding:"+(this.options.style.padding||"10px")+";--padding-horizontal:"+(this.options.style.paddingHorizontal||"15px")+";--gap:"+(this.options.style.gap||"10px")+";--border-radius:"+(this.options.style.borderRadius||"8px")+";--border-radius-input:"+(this.options.style.borderRadiusInput||"4px")+";--font-size:"+(this.options.style.fontSize||"14px")+";--transition:"+(this.options.style.transition||"0.2s")+" ease;--transition-fast:"+(this.options.style.transitionFast||"0.1s")+" ease;--transition-input:"+(this.options.style.transitionInput||"0.2s")+" ease;}",e.textContent+=".context-menu{background:var(--context-menu-bg);border:1px solid var(--context-menu-border);border-radius:var(--border-radius);box-shadow:var(--context-menu-shadow);padding:var(--padding) 0;min-width:220px;z-index:1000;font-family:Arial,sans-serif;color:var(--context-menu-text);animation:contextMenuSlideIn var(--transition-fast) forwards;transform-origin:top center}.context-menu .context-menu{position:relative;left:-5px}.context-menu:has(> .context-menu-dropdown)::after{content:'';position:absolute;inset:0 0 -400% 0;z-index:-1}.context-menu-button,.context-menu-checkbox,.context-menu-radio,.context-menu-submenu{display:flex;align-items:center;width:100%;padding:calc(var(--padding) + 2px) var(--padding-horizontal);border:none;background:0 0;font-size:var(--font-size);text-align:left;cursor:pointer;color:var(--context-menu-text);transition:background-color var(--transition-fast),color var(--transition-fast);position:relative;gap:var(--gap)}.context-menu-button:hover,.context-menu-checkbox:hover,.context-menu-radio:hover,.context-menu-search-select-list label:hover,.context-menu-submenu:hover{background-color:var(--context-menu-hover-bg)}.context-menu-button:focus,.context-menu-submenu:focus{outline:0;background-color:var(--context-menu-hover-bg)}.context-menu-button[data-marked=true],.context-menu-checkbox input:checked,.context-menu-radio input:checked{background-color:var(--context-menu-accent)}.context-menu-button:focus-visible,.context-menu-submenu:focus-visible{outline:2px solid var(--context-menu-accent);outline-offset:-2px}.context-menu-button:disabled{color:rgba(26,26,26,.4);cursor:not-allowed}.context-menu-button[data-marked=true]{font-weight:700;color:#fff;border-radius:calc(var(--border-radius)/ 2);border:1px solid var(--context-menu-accent)}.context-menu-button[data-marked=true]:hover{background-color:var(--context-menu-accent);color:#fff}.context-menu-button span,.context-menu-submenu span{display:flex;align-items:center;pointer-events:none}.context-menu-separator{height:1px;background-color:var(--context-menu-separator);margin:var(--padding) 0}.context-menu-dropdown,.context-menu-input input,.context-menu-search-select input{padding:var(--padding);border:1px solid var(--context-menu-border);border-radius:var(--border-radius-input);font-size:var(--font-size);background-color:#f9fafb;transition:border-color var(--transition-input),box-shadow var(--transition-input)}.context-menu-double-input,.context-menu-input{padding:var(--padding) var(--padding-horizontal)}.context-menu-dropdown:focus,.context-menu-input input:focus,.context-menu-search-select input:focus{outline:0;border-color:var(--context-menu-accent);box-shadow:0 0 0 2px rgba(59,130,246,.2)}.context-menu-input input{width:calc(100% - var(--padding-horizontal))}.context-menu-double-input{display:flex;gap:10px;align-items:center}.context-menu-double-input>.context-menu-input{padding:unset!important}.context-menu-dropdown{width:calc(100% - calc(var(--padding-horizontal) * 2));margin:var(--padding) var(--padding-horizontal)}.context-menu-checkbox input,.context-menu-radio input,.context-menu-search-select-list input{margin-right:var(--gap);accent-color:var(--context-menu-accent)}.context-menu-checkbox input:focus,.context-menu-radio input:focus,.context-menu-search-select-list input:focus{outline:0;box-shadow:0 0 0 2px rgba(59,130,246,.2)}.context-menu-search-select{display:flex;flex-direction:column;padding:calc(var(--padding) + 2px) var(--padding-horizontal)}.context-menu-search-select-list{max-height:200px;overflow-y:auto;margin-top:var(--padding)}.context-menu-search-select-list button{width:100%;padding:var(--padding);background:#007bff;font-size:var(--font-size);text-align:left;cursor:pointer;color:#fff;transition:background-color var(--transition-fast),color var(--transition-fast)}.context-menu-search-select-list label{display:flex;flex-direction:row-reverse;gap:var(--gap);align-items:center;padding:var(--padding) 0;justify-content:flex-end}@keyframes contextMenuSlideIn{from{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(calc(-1 * var(--padding)))}}.context-menu:focus{outline:0}",document.head.appendChild(e)}}class BaseTypePlugin{constructor(e={}){if(this.constructor===BaseTypePlugin)throw new Error("BaseTypePlugin is abstract");this.operators=["==","!="],this.sortingHint="string"}validate(e){throw new Error("validate must be implemented")}parseValue(e){throw new Error("parseValue must be implemented")}evaluateCondition(e,t,n){throw new Error("evaluateCondition must be implemented (when operator is not '==' or '!=')")}getConditionChecker(e,t){switch(e){case"==":return e=>e===t;case"!=":return e=>e!==t;default:return n=>this.evaluateCondition(n,e,t)}}evaluate(e,t,n,r){const{field:i,operator:o,value:s}=e,a=this.parseValue(s),l=this.getConditionChecker(o,a),c=t?.[i];if(c&&r&&c.size<=r.size){const e=c.keys();let t=e.next();for(;!t.done;){const n=t.value;if(!l(this.parseValue(n))){const e=c.get(n);for(const t of e)r.delete(t)}t=e.next()}}else{const e=r.values();let t=e.next();const o=[];for(;!t.done;){const r=t.value,s=n[r][i];l(this.parseValue(s))||o.push(r),t=e.next()}for(let e=0;e<o.length;e++)r.delete(o[e])||console.warn(`Failed to delete index: ${o[e]}`)}return r}getInputComponent(e,t){const n=document.createElement("input");return n.type="text",n.name="_",n.value=e??"",n.addEventListener("input",(e=>t(e.target.value))),n}getContextMenuItems(e,t,n){return[]}}class EditTracker{constructor(){this.updates=[]}addEdit(e){this.updates.push(e),this.updates=this.cleanUpdates(this.updates)}cleanUpdates(e){const t=new Map;return e.forEach((e=>{const n=`${e.row.internal_id}_${e.column}`;t.set(n,{...e})})),Array.from(t.values()).filter((e=>e.previousValue!==e.newValue))}clear(){this.updates=[],document.querySelectorAll(".body-cell.edited").forEach((e=>{e.classList.remove("edited")}))}}class CSVExportConnector extends ExportConnector{constructor(){super(),this.name="csv",this.mimeType="text/csv",this.extension="csv",this.delimiter=";"}export(e){if(!Array.isArray(e)||0===e.length)throw new Error("Invalid or empty data provided for CSV export");const t=Object.keys(e[0]),n=e.map((e=>t.map((t=>{const n=e[t];return"string"==typeof n&&n.includes(this.delimiter)?`"${n.replace(/"/g,'""')}"`:n})).join(this.delimiter)));return[t.join(this.delimiter),...n].join("\n")}}class XLSXExportConnector extends ExportConnector{constructor(){super(),this.name="xlsx",this.mimeType="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",this.extension="xlsx"}loadLibrary(){return window.XLSX?Promise.resolve():(this._libraryPromise||(this._libraryPromise=new Promise(((e,t)=>{if(window.XLSX)return e();const n=document.createElement("script");n.src="https://grid.kronk.tech/xlsx.bundle.js",n.type="application/javascript",n.onload=()=>e(),n.onerror=()=>t(new Error("Failed to load XLSX library")),document.head.appendChild(n)}))),this._libraryPromise)}async exportAsync(e,t,n){if(!Array.isArray(e)||0===e.length)throw new Error("Invalid or empty data provided for XLSX export");try{await Promise.race([this.loadLibrary(),new Promise(((e,t)=>setTimeout((()=>t(new Error("XLSX library load timeout"))),5e3)))]);const n=XLSX.utils.book_new(),r=XLSX.utils.json_to_sheet(e),i=Object.keys(t).length;return r["!autofilter"]={ref:`A1:${this.getExcelHeaderLetter(i-2)}1`},r["!cols"]=this.fitToColumn(e),r["!cols"].forEach(((e,t)=>{const n=this.getExcelHeaderLetter(t);r[`${n}1`].s={font:{bold:!0,color:{rgb:"FFFFFF"}},fill:{fgColor:{rgb:"4BACC6"}},alignment:{horizontal:"left",vertical:"top"}}})),XLSX.utils.book_append_sheet(n,r,"Sheet"),XLSX.write(n,{type:"array",bookType:"xlsx"})}catch(e){throw console.error("Error during XLSX export:",e),e}}getExcelHeaderLetter(e){let t="";for(;e>=0;)t=String.fromCharCode(e%26+65)+t,e=Math.floor(e/26)-1;return t}fitToColumn(e,t){const n=[];for(const t in e[0])n.push({wch:Math.max(t.length+3,...e.map((e=>e[t]?.toString()?.length??0)))});return n}}class JSONExportConnector extends ExportConnector{constructor(){super(),this.name="json",this.mimeType="application/json",this.extension="json"}export(e,t,n){if(!Array.isArray(e)||0===e.length)throw new Error("Invalid or empty data provided for JSON export");return JSON.stringify(e,null,2)}}class XMLExportConnector extends ExportConnector{constructor(){super(),this.name="xml",this.mimeType="application/xml",this.extension="xml"}export(e,t,n){if(!Array.isArray(e)||0===e.length)throw new Error("Invalid or empty data provided for XML export");return this.jsonToXML(e)}jsonToXML(e){let t="<root>\n";return e.forEach((e=>{t+="  <item>\n";for(const n in e)t+=`    <${n}>${e[n]}</${n}>\n`;t+="  </item>\n"})),t+="</root>",t}}class HTMLExportConnector extends ExportConnector{constructor(){super(),this.name="html",this.mimeType="text/html",this.extension="html"}export(e,t,n){if(!Array.isArray(e)||0===e.length)throw new Error("Invalid or empty data provided for HTML export");let r="<table>\n";return r+=this.headersToHTML(Object.keys(t)),r+=this.jsonToHTML(e),r+="</table>",r}headersToHTML(e){let t="  <tr>\n";return e.forEach((e=>{t+=`    <th>${e}</th>\n`})),t+="  </tr>\n",t}jsonToHTML(e){let t="";return e.forEach((e=>{t+="  <tr>\n";for(const n in e)t+=`    <td>${e[n]}</td>\n`;t+="  </tr>\n"})),t}}class TXTExportConnector extends ExportConnector{constructor(){super(),this.name="txt",this.mimeType="text/plain",this.extension="txt"}export(e,t,n){if(!Array.isArray(e)||0===e.length)throw new Error("Invalid or empty data provided for TXT export");return e.map((e=>Object.values(e).join("\t"))).join("\n")}}class QueryParser{constructor(e){this.config={useStrictCase:e.useStrictCase||!1,SymbolsToIgnore:e.SymbolsToIgnore||["_","-"]}}static QUERIES={FUZZY:/^search\s+"([^"]+)"$/i,GROUP:/group\s+(.+)/i,RANGE:/range\s+(?:(-?\d+)-(-?\d+)?|(-?\d+))/i,SORT:/sort\s+(.+)\s+(asc|desc)/i,SELECT:/(\S+)\s(\S+)\s(.*)/i};parseQuery(e,t,n){return e.split(/\s+and\s+|\s+&&\s+/i).map((e=>this.parseSubQuery(e.trim(),t,n))).filter((e=>e.queryType))}parseSubQuery(e,t,n){if(!(e=e.endsWith(" and")?e.slice(0,-4):e)||0===e.length)return{};for(const[r,i]of Object.entries(QueryParser.QUERIES)){const o=i.exec(e);if(o)return this.parseMatch(o,r,t,n)||{}}return console.warn("Invalid query: "+e+"\nValid queries are: "+Object.keys(QueryParser.QUERIES).join(", ").toLowerCase()+"\nQuery: "+e),{}}parseMatch(e,t,n,r){if("SELECT"===t){let[t,n,i,o]=e;n=findMatchingIndexKey(Object.keys(r),n,this.config);const s=r[n]&&r[n].plugin;if(!s)throw new GridError("No plugin found for header ("+s.type+") for key ("+n+")\nDo you know certain that the name of the key is correct?");if(!s.operators.includes(i))throw new GridError(this.formatOperatorError(i,n+" "+i+" "+o,s));if(!s.validate(o))throw new GridError("Invalid value: "+o+"\nFor query: "+n+" "+i+" "+o+"\n"+this.formatOperatorError(i,n,s));return o=s.parseValue(o),{type:s.name,field:n,operator:i,value:o,queryType:"SELECT"}}if("SORT"===t){let[t,i,o]=e;const s=r[i].type;if(!n[s])throw new GridError("No plugin found for header ("+s+") for key ("+i+")");return{type:s,field:i,operator:"sort",value:o,queryType:"SORT"}}if("RANGE"===t){let[t,n,r,i]=e;return void 0!==i?(n=0,r=parseInt(i)):(n=parseInt(n),r=void 0===r?1/0:parseInt(r),isNaN(n)&&(n=0)),n=Math.max(0,n-1),{type:"range",lower:n,upper:r,queryType:"RANGE"}}if("GROUP"===t){let[t,n]=e;return{type:"group",field:n,queryType:"GROUP"}}if("FUZZY"===t){const[t,n]=e;return{type:"fuzzy",value:n.toLowerCase(),queryType:"FUZZY"}}return console.warn("Invalid query: "+e+"\nValid queries are: "+Object.keys(QueryParser.QUERIES).join(", ").toLowerCase()),{}}formatOperatorError(e,t,n){return["\n\nInvalid operator:    "+e,"       For query:    "+t,"     options are:    "+n.operators.join(", "),"\n"].join("\n")}}class DynamicGridUI{constructor(e,t,n){this.dynamicGrid=e,this.containerId=t.containerId,this.eventEmitter=n,this.eventEmitter.emit("ui-initialized",{containerId:this.containerId}),this.keyboardShortcuts=e.keyboardShortcuts,this.engine=e.engine,this.table=null,this.header=null,this.body=null,this.scrollContainer=null,this.groupedRows=null,this.config={minColumnWidth:t.minColumnWidth??50,rowHeight:t.rowHeight??40,bufferedRows:t.bufferedRows??5,colorScheme:t.colorScheme??"light"},this.virtualScrolling={scrollTop:0,visibleRowsCount:0,startIndex:0,endIndex:0,totalHeight:0,topSpacer:null,bottomSpacer:null},this.#f(this.containerId),this.UIChache=0,this.UICacheRefresh=!1,this.showData=[],this.showDataLength=0,this.hiddenIndices=new Set,this.contextMenu=new ContextMenu({width:250,style:{accent:"#3b82f6",backgroundColor:"#ffffff",textColor:"#333333",padding:"4px"},closeOnClick:!0,closeOnOutsideClick:!0}),this.columnHeaderContextMenu=new ColumnHeaderContextMenu(this.contextMenu,this.engine,this)}render(e){if(!e)return;if(0===e.length)return void this.clearContent();if(this.isGroupedData="object"==typeof e&&Array.isArray(firstItem(e)),this.isGroupedData){this.showData=[];let t=0;Object.keys(e).forEach((n=>{this.showData.push(...e[n]),this.GroupRowRange(t,t+e[n].length-1),t+=e[n].length}))}else this.showData=e;this.showDataLength=this.showData.length;const t=this.engine.getColumns(),n=this.engine.getData(e[0],!0),r=FastHash(t);this.UICacheRefresh=this.UIChache!==r,this.UIChache=r,this.UICacheRefresh&&(this.table=this.#b(t,n)),this.#x(t),this.#v(),this.eventEmitter.emit("ui-rendered",{...this.showData})}toggleColumn(e){const t="number"==typeof e?e:this.engine.getColumns().indexOf(e.toLowerCase());"collapse"===this.colGroup1.children[t+1].style.visibility?this.#E(t):this.#C(t)}clearContent(){this.table&&(this.bodyTable?.remove(),this.scrollContainer?.remove()),this.showData=[],this.eventEmitter.emit("ui-content-cleared")}destroy(){this.clearContent(),this.table?.remove(),this.headerTable?.remove(),this.scrollContainer?.remove(),this.bodyTable?.remove(),this.eventEmitter.removeAllListeners(),this.contextMenu.destroy(),this.columnHeaderContextMenu=null,this.table=null,this.headerTable=null,this.bodyTable=null,this.scrollContainer=null,this.colGroup1=null,this.colGroup2=null}GroupRowRange(e,t){if(e<0||t>=this.showData.length||e>t)throw new GridError("Invalid row range to hide");const n=document.createElement("div");n.className="grouped-row",n.setAttribute("s",e),n.setAttribute("_s",e),n.setAttribute("l",t-e+1),this.groupedRows.appendChild(n),n.onclick=()=>{this.toggleGroupedRow(n)},this.#S(),this.virtualScrolling.startIndex=0,this._updateVisibleRows(),this.eventEmitter.emit("ui-row-range-hidden",{startIndex:e,endIndex:t})}toggleGroupedRow(e,t=-1){const n=parseInt(e.getAttribute("_s"),10),r=n+parseInt(e.getAttribute("l"),10)-1;-1===t&&e.classList.toggle("hidden");const i=-1===t?e.classList.contains("hidden"):1!=t,o=e.previousElementSibling;if(i){for(let e=n+1;e<=r;e++)this.hiddenIndices.add(this.showData[e]);if(o){const t=parseInt(o.getAttribute("s"),10),n=parseInt(o.getAttribute("l"),10);e.setAttribute("s",`${o.classList.contains("hidden")?t+1:t+n}`)}else e.setAttribute("s",n);const t=e.parentNode,i=Array.from(t.children);for(let t=i.indexOf(e)+1;t<i.length;t++){const n=i[t];n.classList.contains("grouped-row")&&n.setAttribute("s",""+(parseInt(n.getAttribute("s"),10)+1-parseInt(e.getAttribute("l"),10)))}this.eventEmitter.emit("ui-row-range-hidden",{startIndex:n,endIndex:r})}else{for(let e=n+1;e<=r;e++)this.hiddenIndices.delete(this.showData[e]);const t=e.parentNode,i=Array.from(t.children);for(let t=i.indexOf(e)+1;t<i.length;t++){const n=i[t];n.classList.contains("grouped-row")&&n.setAttribute("s",""+(parseInt(n.getAttribute("s"),10)+parseInt(e.getAttribute("l"),10)-1))}this.eventEmitter.emit("ui-row-range-shown",{startIndex:n,endIndex:r})}this.#S(),this.virtualScrolling.startIndex=0,this._updateVisibleRows()}#C(e){const t=this.colGroup1.children[e+1],n=this.headerTable.querySelector(`th:nth-child(${e+2})`);t&&(t.style.visibility="collapse",n.style.pointerEvents="none");const r=this.colGroup2.children[e+1];r&&(r.style.visibility="collapse")}#E(e){const t=this.colGroup1.children[e+1],n=this.headerTable.querySelector(`th:nth-child(${e+2})`);t&&(t.style.visibility="visible",n.style.pointerEvents="auto");const r=this.colGroup2.children[e+1];r&&(r.style.visibility="visible")}#f(e){if(this.container=document.querySelector(e),!this.container)throw new GridError(`Container with id "${e}" not found`);this.keyboardShortcuts.addShortcut("ctrl+shift+a","Shortcut to automatically fit the columns to a (almost) perfect fit",(()=>{this.autoFitCellWidth()})),this.keyboardShortcuts.addShortcut("ctrl+shift+r","Shortcut to refresh the UI",(()=>{this.UICacheRefresh=!0,this.render(this.showData)})),this.keyboardShortcuts.addShortcut("ctrl+shift+g","Shortcut to toggle all grouped rows",(()=>{const e=this.groupedRows.querySelectorAll(".grouped-rows > .grouped-row");if(0===e.length)return;const t=e[0].classList.contains("hidden");e.forEach((e=>{t&&e.classList.contains("hidden")?this.toggleGroupedRow(e):t||e.classList.contains("hidden")||this.toggleGroupedRow(e)})),this.#S(),this.virtualScrolling.startIndex=0,this._updateVisibleRows()})),this.container.addEventListener("keydown",(e=>{["ctrl","shift","alt"].forEach((t=>{e[`${t}Key`]&&this.container.setAttribute(t,"true")}))})),this.container.addEventListener("keyup",(e=>{["ctrl","shift","alt"].forEach((t=>{e[`${t}Key`]||this.container.removeAttribute(t)}))})),this.eventEmitter.emit("ui-container-initialized",{containerId:e})}#b(){return this.UICacheRefresh?(this.table?.remove(),this.table=document.createElement("div"),this.table.className="table",this.table):this.table}#x(e){const t=this.table&&this.table.parentNode,n=this.headerTable&&this.headerTable.parentNode,r=this.bodyTable&&this.bodyTable.parentNode;if(t||(this.table=document.createElement("div"),this.table.className="dynamic-grid-table",this.table.dataset.theme=this.config.colorScheme),!n){this.headerTable=document.createElement("table"),this.headerTable.className="dynamic-grid-table-header",this.headerTable.setAttribute("cellspacing","0"),this.headerTable.setAttribute("cellpadding","0");const t=this.#w(e);this.colGroup1=t,this.headerTable.appendChild(t),this.headerTable.appendChild(this.#T(e)),this.table.appendChild(this.headerTable)}if(r)this.bodyTable.innerHTML="",this.bodyTable.appendChild(this.colGroup2);else{this.scrollContainer=document.createElement("div"),this.scrollContainer.className="dynamic-grid-scroll-container",this.scrollContainer.style.position="relative",this.scrollContainer.style.width="100%",this.bodyTable=document.createElement("table"),this.bodyTable.className="dynamic-grid-table-body",this.bodyTable.setAttribute("cellspacing","0"),this.bodyTable.setAttribute("cellpadding","0");const t=this.#w(e);this.colGroup2=t,this.bodyTable.appendChild(t),this.virtualScrolling.topSpacer=document.createElement("tr"),this.virtualScrolling.topSpacer.style.height="0px",this.virtualScrolling.topSpacer.className="virtual-scroll-spacer top-spacer",this.virtualScrolling.bottomSpacer=document.createElement("tr"),this.virtualScrolling.bottomSpacer.style.height="0px",this.virtualScrolling.bottomSpacer.className="virtual-scroll-spacer bottom-spacer",this.scrollContainer.appendChild(this.bodyTable),this.table.appendChild(this.scrollContainer),this.groupedRows=document.createElement("div"),this.groupedRows.className="grouped-rows",this.groupedRows.style.setProperty("--y-offset","0px"),this.table.appendChild(this.groupedRows)}this.body=this.#I(),this.bodyTable.appendChild(this.body),this.container.appendChild(this.table)}#w(e){const t=document.createElement("colgroup"),n=document.createElement("col");n.style.width="30px",n.setAttribute("resizable","false"),t.appendChild(n);var r=0;for(const n in e){if("string"!=typeof e[n])continue;const i=this.engine.getHeader(e[n]).config,o=document.createElement("col");r+=i.width??100,o.style.width=`${i.width??100}px`,o.style.minWidth=`${i.minWidth}px`,o.style.maxWidth=`${i.maxWidth}px`,i.resizable&&o.setAttribute("resizable","true"),t.appendChild(o)}return t.style.width=`${r}px`,t}#T(e){const t=document.createElement("thead"),n=document.createElement("tr");n.className="header-row";const r=document.createElement("th");return r.className="header-cell top-left-corner",n.appendChild(r),r.addEventListener("contextmenu",(e=>(e.preventDefault(),e.stopPropagation(),this.contextMenu.clear(),this.contextMenu.searchSelect("Columns to show/hide",this.engine.getColumns().map((e=>({label:e,value:e,checked:!0}))),{onChange:e=>{const t=this.engine.getColumns(),n=t.filter((t=>!e.includes(t)));t.forEach((e=>{n.includes(e)?this.#C(t.indexOf(e)):this.#E(t.indexOf(e))}))}}),this.contextMenu.showAt(100,100)))),e.forEach(((e,t)=>{t++;const r=this.engine.headers[e],i=(r.plugin||this.engine.getPlugin(e),document.createElement("th"));i.className="header-cell",i.className+=` ${r.config.headerClass||""}`,i.style.height=`${this.config.rowHeight}px`,i.style.position="relative";const o=document.createElement("div");o.className="header-cell-content";const s=document.createElement("button");s.className="header-cell-button",s.innerText="▼";const a=document.createElement("span");if(a.className="header-cell-text",a.innerText=r.name||e,o.appendChild(s),o.appendChild(a),i.appendChild(o),r.config.resizable){const e=document.createElement("div");e.className="header-resize-handle";let n=!1,r=0,o=0;const s=this.colGroup1?.children[t];let a=0;e.addEventListener("mouseenter",(()=>{e.classList.add("hover")})),e.addEventListener("mouseleave",(()=>{n||e.classList.remove("hover")})),e.addEventListener("mousedown",(i=>{n=!0,r=i.clientX,o=s?.offsetWidth||100;const l=e=>{if(!n||!s)return;const t=e.clientX-r;a=Math.max(this.config.minColumnWidth,o+t),a=Math.max(a,this.config.minColumnWidth),s.style.width=`${a}px`},c=()=>{n=!1,e.classList.remove("hover"),this.colGroup2.children[t].style.width=`${a}px`,document.removeEventListener("mousemove",l),document.removeEventListener("mouseup",c)};document.addEventListener("mousemove",l),document.addEventListener("mouseup",c)})),i.appendChild(e)}i.addEventListener("contextmenu",(t=>{t.preventDefault(),t.stopPropagation(),this.columnHeaderContextMenu.showForColumn(e,i,t.clientX,t.clientY)})),n.appendChild(i)})),t.appendChild(n),t}#I(){const e=document.createElement("tbody");return e.appendChild(this.virtualScrolling.topSpacer),e.appendChild(this.virtualScrolling.bottomSpacer),this.body=e,e}#v(){if(!this.table||!this.showData.length)return;const e=this.showData.length;this.virtualScrolling.totalHeight=e*this.config.rowHeight,this.#S();const t=this.table.clientHeight||400;this.virtualScrolling.visibleRowsCount=Math.ceil(t/this.config.rowHeight);const n=this.virtualScrolling.visibleRowsCount+2*this.config.bufferedRows;this.virtualScrolling.startIndex=0,this.virtualScrolling.endIndex=Math.min(n,e),this.table.addEventListener("scroll",this.#M.bind(this)),this._updateVisibleRows(),this.virtualScrolling.scrollTop>0&&(this.table.scrollTop=this.virtualScrolling.scrollTop)}#M(e){const t=e.target.scrollTop,n=this.config.rowHeight;this.virtualScrolling.scrollTop=t,this.groupedRows.style.setProperty("--y-offset",`${t}px`);const r=Math.floor(t/n),i=Math.max(0,r-this.config.bufferedRows),o=this.visibleIndices,s=Math.min(i,o.length-1),a=Math.min(s+this.virtualScrolling.visibleRowsCount+2*this.config.bufferedRows,o.length);s===this.virtualScrolling.startIndex&&a===this.virtualScrolling.endIndex||(this.virtualScrolling.startIndex=s,this.virtualScrolling.endIndex=a,this._updateVisibleRows())}_updateVisibleRows(){const e=this.visibleIndices,t=this.virtualScrolling.startIndex,n=Math.min(t+this.virtualScrolling.visibleRowsCount+2*this.config.bufferedRows,e.length);Array.from(this.body.querySelectorAll("tr:not(.virtual-scroll-spacer)")).forEach((e=>e.remove()));const r=document.createDocumentFragment();for(let i=t;i<n;i++){const t=e[i],n=this.showData[t],o=this.#_(n);r.appendChild(o)}this.virtualScrolling.topSpacer.after(r),this.virtualScrolling.topSpacer.style.height=t*this.config.rowHeight+"px",this.virtualScrolling.bottomSpacer.style.height=(e.length-n)*this.config.rowHeight+"px"}#L(e){for(;e<this.showData.length&&this.hiddenIndices.has(this.showData[e]);)e++;return e}#S(){this.visibleIndices=this.showData.map(((e,t)=>t)).filter((e=>!this.hiddenIndices.has(this.showData[e])))}#_(e){const t=document.createElement("tr");return t.dataset.index=e,this.engine.getData(e).then((n=>{const r=document.createElement("td");r.className="body-cell",r.style.height=`${this.config.rowHeight}px`,r.innerText=this.showData.indexOf(e)+1,t.appendChild(r),Object.entries(n).forEach((([r,i])=>{if("internal_id"===r)return;const o=this.engine.getHeader(r),s=o.plugin||this.engine.getPlugin(r),a=t=>{this.engine.updateTracker.addEdit({column:r,row:n,previousValue:i,newValue:t}),this.engine.alterData(e,r,t),this.eventEmitter.emit("ui-cell-edit",{column:r,row:n,previousValue:i,newValue:t}),l.classList.add("edited")};let l=document.createElement("td");try{if(o.config.isEditable){const e="function"==typeof s.getInputComponent?s.getInputComponent(i,a):BaseTypePlugin.prototype.getInputComponent(i,a);l.appendChild(e)}else{let e=document.createElement("span");e.className="cell-value",e.innerText=void 0!==i?String(i):"",l.appendChild(e)}}catch(e){switch(console.error(`Error rendering cell for key "${r}" with value "${i}":\n`,e),e.name){case"RangeError":l.innerText="YYYY-MM-DD";break;case"TypeError":l.innerText=`Invalid value: ${i}`;break;case"SyntaxError":l.innerText=`Syntax Error: ${e.message}`;break;case"GridError":l.innerText=`Grid Error: ${e.message}`;break;default:l.innerText=`Error: ${e.message}`}l.style.backgroundColor="red"}o.config.cellClass&&l.classList.add(...o.config.cellClass.split(" ")),l instanceof HTMLTableCellElement||(console.error(s.name+".renderCell() did not return a td element",{td:l,value:i,key:r,plugin:s}),l=document.createElement("td"),l.style.backgroundColor="red",l.innerText="Invalid cell"),l.classList.add("body-cell"),l.style.height=`${this.config.rowHeight}px`,t.appendChild(l)}))})),t}approximateColumnWidth(e){function t(e){const t=Math.max(...e.map((e=>String(e).length)));return Math.max(50,8.75*t)}if(e)return t([this.engine.getData(0,!0)[e].toString()]);const n=this.engine.getColumns(),r={};return n.forEach((e=>{const n=this.engine.getData(0,!0);n&&void 0!==n[e]?r[e]=t([n[e]]):r[e]=this.config.minColumnWidth})),r}#k(e){for(let t=0;t<e.length;t++)this.setWidth(t,e[t])}autoFitCellWidth(){this.#k(Object.values(this.approximateColumnWidth()))}setWidth(e,t){this.colGroup1.children[e+1].style.width=`${t}px`,this.colGroup2.children[e+1].style.width=`${t}px`}}class BooleanTypePlugin extends BaseTypePlugin{constructor(){super(),this.sortingHint="boolean"}validate(e){return[!0,!1,"true","false",1,0,"1","0"].includes(e)}parseValue(e){return!0===e||"true"===e||1===e||"1"===e}getInputComponent(e,t){const n=document.createElement("input");return n.type="checkbox",n.name="_",n.checked=this.parseValue(e),n.addEventListener("change",(()=>t(n.checked))),n}getContextMenuItems(e,t,n){return[{type:"action",label:"Only True",action:()=>{t.setSelect(e,"==",!0),n.render(t.runCurrentQuery())}},{type:"action",label:"Only False",action:()=>{t.setSelect(e,"==",!1),n.render(t.runCurrentQuery())}},{type:"action",label:"Clear Filter",action:()=>{t.removeSelect(e),n.render(t.runCurrentQuery())}},{type:"sort",label:"Sort",sortingHint:this.sortingHint}]}}class DateTypePlugin extends BaseTypePlugin{constructor(e={}){super(),this.sortingHint="date",this.minDate=e.minDate||null,this.maxDate=e.maxDate||null}validate(e){return!isNaN(Date.parse(e))}parseValue(e){return new Date(e)}getInputComponent(e,t){const n=document.createElement("input");return n.type="date",n.name="_",n.value=e?new Date(e).toISOString().split("T")[0]:"",this.minDate&&(n.min=new Date(this.minDate).toISOString().split("T")[0]),this.maxDate&&(n.max=new Date(this.maxDate).toISOString().split("T")[0]),n.addEventListener("change",(()=>t(n.value))),n}}class EmailTypePlugin extends BaseTypePlugin{constructor(){super(),this.sortingHint="string"}validate(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}parseValue(e){return e?String(e).toLowerCase().trim():""}getInputComponent(e,t){const n=document.createElement("input");return n.type="email",n.name="_",n.value=e??"",n.addEventListener("input",(e=>t(e.target.value))),n}}class EnumTypePlugin extends BaseTypePlugin{constructor(e=[]){super(),this.options=e,this.sortingHint="string"}validate(e){return this.options.includes(e)}parseValue(e){return e?.toString()}getInputComponent(e,t){const n=document.createElement("select");return n.name="_",this.options.forEach((t=>{const r=document.createElement("option");r.value=t,r.textContent=t,t===e&&(r.selected=!0),n.appendChild(r)})),n.addEventListener("change",(()=>t(n.value))),n}}class NumberTypePlugin extends BaseTypePlugin{constructor(){super(),this.operators=[">","<",">=","<=","><"],this.sortingHint="number"}validate(e){return!isNaN(e)}parseValue(e){const t=parseFloat(e);return isNaN(t)?null:t}evaluateCondition(e,t,n){switch(t){case"==":return e===n;case"!=":return e!==n;case">":return e>n;case"<":return e<n;case">=":return e>=n;case"<=":return e<=n;default:return!1}}getInputComponent(e,t){const n=document.createElement("input");return n.type="text",n.name="_",n.pattern="d*",n.value=e??"",n.addEventListener("input",(()=>t(parseFloat(n.value)))),n}getContextMenuItems(e,t,n){return[{type:"filter",label:"Filter",operators:this.operators},{type:"sort",label:"Sort",sortingHint:this.sortingHint},{type:"action",label:"Calculate Stats",action:()=>this.calculateStats(e)}]}calculateStats(e){}}class PhoneNumberTypePlugin extends BaseTypePlugin{constructor(){super(),this.operators=["%=","=%","*=","!*=","==","!="],this.sortingHint="string"}validate(e){return!isNaN(e)}parseValue(e){const t=parseFloat(e);return isNaN(t)?null:t}evaluateCondition(e,t,n){switch(t){case"==":return e===n;case"!=":return e!==n;case"%=":return String(e).startsWith(n);case"=%":return String(e).endsWith(n);case"*=":return String(e).includes(n);case"!*=":return!String(e).includes(n);default:return!1}}getInputComponent(e,t){const n=document.createElement("input");return n.type="tel",n.name="_",n.pattern="\\+((?:9[679]|8[035789]|6[789]|5[90]|42|3[578]|2[1-689])|9[0-58]|8[1246]|6[0-6]|5[1-8]|4[013-9]|3[0-469]|2[70]|7|1)(?:\\W*\\d){0,13}\\d",n.value=e??"",n.addEventListener("input",(()=>t(n.value))),n}}class StringTypePlugin extends BaseTypePlugin{constructor(){super(),this.operators=["%=","=%","*=","!*="],this.sortingHint="string"}validate(e){return"string"==typeof e}parseValue(e){return null==e?"":String(e)}evaluateCondition(e,t,n){switch(t){case"%=":return String(e).startsWith(n);case"=%":return String(e).endsWith(n);case"*=":return String(e).includes(n);case"!*=":return!String(e).includes(n);default:return!1}}getContextMenuItems(e,t,n){return[{type:"filter",label:"Filter",operators:this.operators},{type:"sort",label:"Sort",sortingHint:this.sortingHint}]}}class SJQLEngine{constructor(e,t){this.data=[],this.headers=[],this.plugins=[],this.connectors=[],this.futureQuery=[],this.QueryParser=new QueryParser(e),this.updateTracker=new EditTracker,this.config={},this.APIConnector=e.APIConnector||null,this.eventEmitter=t,this.currentQueryStr=""}createDataIndex(){this.dataIndexes={},Object.keys(this.headers).forEach((e=>{this.dataIndexes[e]=new Map,this.data.forEach(((t,n)=>{const r=t[e];this.dataIndexes[e].has(r)||this.dataIndexes[e].set(r,new Set),this.dataIndexes[e].get(r).add(n)}))}))}autoDetectHeaders(e){for(const t of Object.keys(e))!0===e[t]||!1===e[t]?this.headers[t]={type:"boolean",isUnique:!1,isHidden:!1,isEditable:!0}:isNaN(e[t])?e[t].match(/^(0?[1-9]|[12][0-9]|3[01])-(0?[1-9]|1[0-2])-(\d{4})$/)?this.headers[t]={type:"date",isUnique:!1,isHidden:!1,isEditable:!0}:this.headers[t]={type:"string",isUnique:!1,isHidden:!1,isEditable:!0}:this.headers[t]={type:"number",isUnique:!1,isHidden:!1,isEditable:!0}}getData(e,t=!1){const n=this.data&&this.data.length>0&&e<this.data.length;if(null==(e=e<0?this.data.length+e:e)||!n)return console.warn("No data provided, returning empty object"),t?{}:new Promise(((e,t)=>{e({})}));if(t){if(!n)throw new Error("No data to return (data is empty, or index is out of bounds)");const{internal_id:t,...r}=this.data[e];return r}return new Promise(((t,r)=>{if(!n)return r(new Error("No data to return (data is empty, or index is out of bounds)"));const{internal_id:i,...o}=this.data[e];t(o)}))}getHeader(e){if(!this.headers||0===Object.keys(this.headers).length)throw new GridError("No headers provided, returning empty object");if(null==e)return console.warn("No key provided, returning all headers"),this.headers;if(this.headers[e])return this.headers[e];throw new GridError(`Header not found for key: ${e} ${this.headers} ${e}`)}getColumns(){return this.data&&0!==this.data.length?Object.keys(this.data[0]).filter((e=>"internal_id"!==e)):(console.warn("No data provided, returning empty array"),[])}sortData(e,t,n,r){const i=r?.sortingHint||"string";return[...e].sort(((e,o)=>{const s=r.parseValue(e[t]),a=r.parseValue(o[t]);if("number"===i)return"asc"===n?s-a:a-s;if("boolean"===i)return"asc"===n?s===a?0:s?1:-1:s===a?0:s?-1:1;if("string"===i||"text"===i)return"asc"===n?s.localeCompare(a):a.localeCompare(s);if("date"===i){const e=new Date(s),t=new Date(a);return"asc"===n?e-t:t-e}}))}query(e=""){if(!this.data||0===this.data.length)return console.warn("No data provided, returning empty array"),[];if(!e||""===e)return console.warn("No query provided, returning all data"),this.currentQueryStr="",this.data.map(((e,t)=>t));const t=this.QueryParser.parseQuery(e,this.plugins,this.headers);return this.#A(t)}#A(e){if(!e||0===e.length)return this.currentQueryStr="",console.warn("No valid query provided, returning NO data"),[];const t=[];let n=null,r=null,i=null,o=null;for(const s of e)switch(s.queryType){case"SELECT":t.push(s);break;case"SORT":n=s;break;case"RANGE":r=s;break;case"GROUP":i=s;break;case"FUZZY":o=s}this.currentQueryStr="",t.forEach((e=>this.currentQueryStr+=e.field+" "+e.operator+" "+e.value+" and ")),n&&(this.currentQueryStr+="sort "+n.field+" "+n.value+" and "),r&&(this.currentQueryStr+="range "+r.lower+" "+r.upper+" and "),i&&(this.currentQueryStr+="group "+i.field+" and "),o&&(this.currentQueryStr+="search "+o.value+" and "),this.currentQueryStr=this.currentQueryStr.slice(0,-5);let s=new Set(this.data.keys()),a=null;for(const e of t){e.field=findMatchingIndexKey(Object.keys(this.data[0]),e.field,this.config);const t=this.getHeader(e.field)?.plugin||new this.getPlugin(e.type,!0);if(!t)throw new GridError(`No plugin found for header (${e.type}) for key (${e.field})`);s=t.evaluate(e,this.dataIndexes[e.field],this.data,s)}if(r){const e=s.values().next().value,t=r.upper<0?this.data.length+r.upper:Math.max(0,e+r.lower),n=r.upper<0?this.data.length:Math.min(this.data.length-1,e+r.upper-1);s=new Set(Array.from({length:n-t+1},((e,n)=>n+t)))}if(i){const e=findMatchingIndexKey(Object.keys(this.data[0]),i.field,this.config);a={};for(const t of s){const n=this.data[t],r=n[e];(a[r]||=[]).push(n.internal_id)}return n&&console.warn("Sorting grouped data is not yet supported"),a}if(o){const e=o.value,t=Object.keys(this.data[0]).filter((e=>"internal_id"!==e));s=new Set([...s].filter((n=>{const r=this.data[n];return t.some((t=>String(r[t]).toLowerCase().includes(e)))})))}return n?this.sortData(this.data.filter(((e,t)=>s.has(t))),n.field,n.value,this.headers[n.field]?.plugin||new this.getPlugin(n.type,!0)).map((e=>e.internal_id)):Array.from(s)}addSelect(e,t,n){if(!e||!t||void 0===n||""===n)return;const r=`${e} ${t} ${n}`;0===this.currentQueryStr.length?this.currentQueryStr=r:this.currentQueryStr+=` and ${r}`}setSelect(e,t,n){this.removeSelect(e),this.addSelect(e,t,n)}removeSelect(e,t,n){let r=this.currentQueryStr;if(void 0!==e&&void 0===t&&void 0===n)this.currentQueryStr=this.currentQueryStr.split("and").filter((t=>!t.trim().startsWith(e))).join(" and ");else if(void 0!==e&&void 0!==t&&void 0===n)this.currentQueryStr=this.currentQueryStr.split("and").filter((n=>!n.trim().startsWith(`${e} ${t}`))).join(" and ");else if(void 0!==e&&void 0!==t&&void 0!==n){const r=`${e} ${t} ${n}`;this.currentQueryStr=this.currentQueryStr.split("and").filter((e=>e.trim()!==r)).join(" and ")}return r!==this.currentQueryStr}setSort(e,t){if(void 0===e||void 0===t)return void this.removeSort();const n=`sort ${e} ${t}`;this.removeSort(),0===this.currentQueryStr.length?this.currentQueryStr=n:this.currentQueryStr+=` and ${n}`}removeSort(){this.currentQueryStr=this.currentQueryStr.split("and").filter((e=>!e.trim().startsWith("sort"))).join(" and ")}setRange(e,t){if(void 0===e||void 0===t)return void this.removeRange();const n=`range ${e} ${t}`;this.removeRange(),0===this.currentQueryStr.length?this.currentQueryStr=n:this.currentQueryStr+=` and ${n}`}removeRange(){this.currentQueryStr=this.currentQueryStr.split("and").filter((e=>!e.trim().startsWith("range"))).join(" and ")}setGroup(e){if(void 0===e)return void this.removeGroup();const t=`group ${e}`;this.removeGroup(),0===this.currentQueryStr.length?this.currentQueryStr=t:this.currentQueryStr+=` and ${t}`}removeGroup(){this.currentQueryStr=this.currentQueryStr.split("and").filter((e=>!e.trim().startsWith("group"))).join(" and ")}runCurrentQuery(){return this.eventEmitter.emit("engine-query-update",this.currentQueryStr),this.query(this.currentQueryStr)}addPlugin(e,t=!1){const n=new e;if(!(n instanceof BaseTypePlugin))throw new GridError("Plugin must extend BaseTypePlugin");const r=this.getPlugin(n.constructor.name,!0);t&&r||(r&&!t?(console.warn("Plugin already exists, removing the old plugin"),this.plugins[n.constructor.name.replace("TypePlugin","").toLowerCase()]=e):this.plugins[n.constructor.name.replace("TypePlugin","").toLowerCase()]=e)}getPlugin(e,t=!1){if(!e)throw new GridError("Plugin name not provided");if("string"!=typeof e)return!1;var n=this.plugins[e.replace("TypePlugin","")]||this.plugins[this.headers[e]?.type];if(!n&&!t)throw new GridError("Plugin not found for column: "+e);return!(!n&&t)&&n}generatePluginInstance(e,t={}){const n=this.getPlugin(e);if(!n)throw new GridError("Plugin not found: "+e);const r=new n(t);return r.name=e,r}addConnector(e,t=!1){if(!(e instanceof ExportConnector))throw new GridError("Connector must extend ExportConnector");const n=this.getConnector(e.name,!0);t&&n||(n&&!t?(console.warn("Connector already exists, removing the old Connector"),this.connectors[e.name.replace("ExportConnector","")]=e):this.connectors[e.name.replace("ExportConnector","")]=e)}getConnector(e,t=!1){if(!e)throw new GridError("Connector name not provided");if("string"!=typeof e)return!1;const n=this.connectors[e];if(!n&&!t)throw new GridError("Connector not found: "+e);return!(!n&&t)&&n}destroy(){this.data=[],this.headers=[],this.plugins=[],this.connectors=[],this.futureQuery=[],this.QueryParser=null,this.updateTracker=null,this.config={},this.APIConnector=null,this.eventEmitter.removeAllListeners(),this.eventEmitter=null}importData(e,t){if(this.data&&this.data.length>0)throw new GridError("Data already imported, re-importing data is not (yet) supported");if(void 0===t.type||"object"===t.type)this.#O(e,t);else if("json"===t.type)this.#N(e,t);else{if("csv"!==t.type)throw new GridError("Invalid data type");this.#P(e,t)}0===Object.keys(this.headers).length&&(console.warn("No headers provided, auto detecting headers, please provide so the system can you more optimal plugins"),this.autoDetectHeaders(this.data[0]))}alterData(e,t,n){const r=this.data[e][t];this.data&&this.data.length>0&&(this.data[e][t]=n),this.dataIndexes&&this.dataIndexes[t]&&(this.dataIndexes[t].has(r)&&this.dataIndexes[t].get(r).delete(e),this.dataIndexes[t].has(n)||this.dataIndexes[t].set(n,new Set),this.dataIndexes[t].get(n).add(e))}#O(e,t){if("object"!=typeof e)throw new GridError("Data must be an object (parsed JSON)");if(!Array.isArray(e))throw new GridError("Data must be an array");if(0===e.length)return console.warn("No data provided"),[];this.data=e.map(((e,t)=>{const n={};n.internal_id=t;for(const t of Object.keys(e))n[t]=e[t];return n}))}#N(e,t){if("string"!=typeof e&&"object"!=typeof e)throw new GridError("Data must be a string (raw JSON) OR an object (parsed JSON)");if(e="string"==typeof e?JSON.parse(e):e,!Array.isArray(e))throw new GridError("Data must be an array");if(0===e.length)return console.warn("No data provided"),[];this.data=e.map(((e,t)=>{const n={};n.internal_id=t;for(const t of Object.keys(e))n[t]=e[t];return n}))}#P(e,t){const n=e.split("\n"),r=n[0].split(",").map((e=>e.replace(/"/g,"").replace(" ","_").replace("\r","")));this.data=n.slice(1).map(((e,t)=>{const n=e.split(/(?!"[a-zA-z0-9\s.()]*)(?:,|,"|",)(?![a-zA-z0-9\s.()]*")/gim),i={};return i.internal_id=t,r.forEach(((e,t)=>{"string"==typeof n[t]&&(n[t].endsWith('"')?n[t]=n[t].slice(0,-1):n[t]),i[e]=n[t]})),i})).slice(0,-1)}async requestExport(e,t){const n=this.getConnector(t);if(n){try{const t=await n.smartExport(this.data.map((e=>{const t={};return Object.keys(e).forEach((n=>{"internal_id"!==n&&(t[n]=e[n])})),t})),this.headers,e);if(!t)return void console.warn("No data returned for export");const r=new Blob([t],{type:n.mimeType}),i=URL.createObjectURL(r),o=document.createElement("a");o.href=i,o.download=`${e||"export"}.${n.extension}`,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(i)}catch(e){return console.error(e.message),alert("Export failed. See console for details."),!1}return!0}console.error("Connector not found: "+t)}getExportConnectors=()=>Object.keys(this.connectors)}class DynamicGrid{constructor(e){this.eventEmitter=new EventEmitter,this.keyboardShortcuts=new KeyboardShortcuts,this.engine=new SJQLEngine(e.engine||{},this.eventEmitter),this.engine.plugins=e.plugins??[],this.engine.addPlugin(StringTypePlugin,!0),this.engine.addPlugin(NumberTypePlugin,!0),this.engine.addPlugin(BooleanTypePlugin,!0),this.engine.addPlugin(DateTypePlugin,!0),this.engine.addPlugin(EmailTypePlugin,!0),this.engine.addPlugin(EnumTypePlugin,!0),this.engine.addPlugin(PhoneNumberTypePlugin,!0),this.engine.connectors=e.connectors||[],this.engine.addConnector(new CSVExportConnector,!0),this.engine.addConnector(new XLSXExportConnector,!0),this.engine.addConnector(new JSONExportConnector,!0),this.engine.addConnector(new XMLExportConnector,!0),this.engine.addConnector(new HTMLExportConnector,!0),this.engine.addConnector(new TXTExportConnector,!0),e.headers&&Object.entries(e.headers).forEach((([e,t])=>{this.engine.headers[e]={name:t.name||e,type:t.type,config:{isUnique:t.isUnique||!1,isEditable:void 0===t.isEditable||t.isEditable,isGroupable:void 0===t.isGroupable||t.isGroupable,isSortable:void 0===t.isSortable||t.isSortable,spellCheck:t.spellCheck||!1,cellClass:t.cellClass||"",headerClass:t.headerClass||"",cellStyle:t.cellStyle||{},width:t.width||100,minWidth:t.minWidth||0,maxWidth:t.maxWidth||1e4,resizable:void 0===t.resizable||t.resizable,cellValueValidator:t.cellValueValidator||(e=>({valid:!0,message:""}))},options:t.options||{}},this.engine.headers[e].plugin=this.engine.generatePluginInstance(t.type,this.engine.headers[e].options||{}),this.engine.headers[e].plugin.operators=["==","!=",...this.engine.headers[e].plugin.operators]})),this.virtualScrolling=e.ui.virtualScrolling??!0,this.rowHeight=e.ui.rowHeight||40,this.visibleRows=e.ui.visibleRows||20,this.ui=new DynamicGridUI(this,e.ui,this.eventEmitter),this.keyboardShortcuts.addShortcut("ctrl+s","Shortcut to save the changed data",(()=>{this.eventEmitter.emit("save-changes-requested",{data:this.engine.updateTracker.updates,updateSuccess:()=>this.engine.updateTracker.clear()})})),this.eventEmitter.emit("grid-initialized",{config:e})}importData(e,t){this.engine.importData(e,t),this.engine.createDataIndex(),this.eventEmitter.emit("grid-data-imported",{data:e,config:t})}render(e){this.eventEmitter.emit("ui-render-start",{input:e}),this.ui.render(this.engine.query(e)),this.eventEmitter.emit("ui-render-end",{input:e})}renderRaw(e){this.ui.render(e),this.eventEmitter.emit("ui-raw-rendered",{input:e})}addSelect=(e,t,n)=>this.engine.addSelect(e,t,n);setSelect=(e,t,n)=>this.engine.setSelect(e,t,n);removeSelect=(e,t,n)=>this.engine.removeSelect(e,t,n);setSort=(e,t)=>this.engine.setSort(e,t);removeSort=()=>this.engine.removeSort();setRange=(e,t)=>this.engine.setRange(e,t);removeRange=()=>this.engine.removeRange();setGroup=e=>this.engine.setGroup(e);removeGroup=()=>this.engine.removeGroup();runCurrentQuery=()=>this.engine.runCurrentQuery();exportData=(e,t)=>!t&&e&&e.includes(".")?this.engine.requestExport(e.split(".")[0],e.split(".")[1]):this.engine.requestExport(e,t);get exportableFileFormats(){return this.engine.getExportConnectors()}on=(e,t)=>this.eventEmitter.on(e,t);subscribe=(e,t)=>this.eventEmitter.on(e,t);off=(e,t)=>this.eventEmitter.off(e,t);unsubscribe=(e,t)=>this.eventEmitter.off(e,t);destroy(){this.eventEmitter.removeAllListeners(),this.ui.destroy(),this.engine.destroy(),this.keyboardShortcuts.destroy(),this.eventEmitter=null,this.ui=null,this.engine=null,this.keyboardShortcuts=null}}
//# sourceMappingURL=DynamicGrid.min.js.map