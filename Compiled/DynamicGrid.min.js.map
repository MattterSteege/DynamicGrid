class DynamicGrid{constructor(e){this.engine=new SJQLEngine(e.engine||{}),this.engine.plugins=e.plugins??[],this.engine.addPlugin(new stringTypePlugin,!0),this.engine.addPlugin(new numberTypePlugin,!0),this.engine.addPlugin(new booleanTypePlugin,!0),e.headers&&Object.entries(e.headers).forEach((([e,t])=>{this.engine.headers[e]=t.toLowerCase()})),this.virtualScrolling=e.ui.virtualScrolling??!0,this.rowHeight=e.ui.rowHeight||40,this.visibleRows=e.ui.visibleRows||20,this.ui=new DynamicGridUI(this,e.ui)}importData(e,t){this.engine.importData(e,t),this.engine.createDataIndex()}render(e){this.ui.render(this.engine.query(e))}}class DynamicGridUI{constructor(e,t){this.dynamicGrid=e,this.containerId=t.containerId,this.table=null,this.header=null,this.body=null,this.scrollContainer=null,this.config={minColumnWidth:t.minColumnWidth??5,rowHeight:t.rowHeight??40,bufferedRows:t.bufferedRows??10,autoFitCellWidth:t.autoFitCellWidth??"header"},this.#e(this.containerId),this.UIChache=0,this.UICacheRefresh=!1,this.sortDirection="asc"}render(e){if(!e||0===e.length)return this.body?.remove(),void this.scrollContainer?.remove();const t=(e=>Array.isArray(firstItem(e)))(e),n=t?Object.keys(firstItem(e)[0]):Object.keys(e[0]),i=t?firstItem(e)[0]:e[0],r=FastHash(n);this.UICacheRefresh=this.UIChache!==r,this.UIChache=r,this.UICacheRefresh&&(this.table=this.#t(n,i,t),this.#n()),this.#i(e,t)}toggleColumn(e){const t=this.columnWidths[e];this.columnWidths[e]=0===t?100:0;const n=this.columnWidths.filter((e=>e>0)).length;this.columnWidths=this.columnWidths.map((e=>0===e?0:100/n)),this.#r(this.table)}#e(e){if(this.container=document.querySelector(e),!this.container)throw new GridError(`Container with id "${e}" not found`)}#n(){this.table.addEventListener("mousedown",(e=>{e.button;const t=e.target.closest(".resizer");if(!t)return;const n=parseInt(t.getAttribute("data-index"),10);let i,r,s;const o=this.table;i=e.clientX,r=this.columnWidths[n],s=this.columnWidths[n+1];const onMouseMove=e=>{const t=(e.clientX-i)/o.offsetWidth*100,a=r+t,l=s-t;a>=this.config.minColumnWidth&&l>=this.config.minColumnWidth&&(this.columnWidths[n]=Number(a.toFixed(2)),this.columnWidths[n+1]=Number(l.toFixed(2)),this.#r(o))},onMouseUp=()=>{document.removeEventListener("mousemove",onMouseMove),document.removeEventListener("mouseup",onMouseUp)};document.addEventListener("mousemove",onMouseMove),document.addEventListener("mouseup",onMouseUp)}))}#i(e,t){const n=t?Object.keys(firstItem(e)[0]):Object.keys(e[0]);n.remove("internal_id"),this.UICacheRefresh&&(this.header=this.#s(n),this.table.style.display="grid",this.table.style.gridTemplateRows="40px 1fr",this.table.style.width="100%",this.table.style.height="100%",this.#r(this.table),this.table.appendChild(this.header)),this.scrollContainer?.remove(),this.scrollContainer=document.createElement("div"),this.scrollContainer.className="scroll-container",this.scrollContainer.style.overflowY="auto",this.UICacheRefresh&&(this.body=document.createElement("div"),this.body.className="body-container"),t?(this.body=this.#o(e,n),this.scrollContainer=document.createElement("div"),this.scrollContainer.className="scroll-container",this.scrollContainer.style.overflowY="auto",this.scrollContainer.appendChild(this.body),this.table.appendChild(this.scrollContainer),this.container.appendChild(this.table)):(this.scrollContainer.appendChild(this.body),this.scrollContainer.addEventListener("scroll",(()=>this.#a(e,n,this.body,this.scrollContainer))),this.table.appendChild(this.scrollContainer),this.container.appendChild(this.table),this.#a(e,n,this.body,this.scrollContainer))}#a(e,t,n,i){const r=e.length,s=r*this.config.rowHeight;n.style.position="relative",n.style.height=`${s}px`;const o=i.scrollTop,a=i.offsetHeight,l=Math.max(0,Math.floor(o/this.config.rowHeight)-this.config.bufferedRows),u=Math.min(r,Math.ceil((o+a)/this.config.rowHeight)+this.config.bufferedRows),d=document.createElement("div");d.style.position="absolute",d.style.top=l*this.config.rowHeight+"px",d.style.left="0",d.style.right="0",d.style.display="grid",d.style.gridTemplateColumns=t.map(((e,t)=>`var(--column-width-${t+1})`)).join(" ");for(let n=l;n<u;n++){const i=this.#l();t.forEach((t=>{const r=this.dynamicGrid.engine.getPlugin(this.dynamicGrid.engine.headers[t]),s=this.#u(r.renderCell(e[n][t]));i.appendChild(s)})),d.appendChild(i)}n.lastChild&&n.removeChild(n.lastChild),n.appendChild(d)}#o(e,t){this.body?.remove(),this.body=document.createElement("div"),this.body.className="body-container";const n=Object.keys(e);for(const i of n){const n=e[i],r=document.createElement("details");r.open=!1,r.style.margin="0",r.style.padding="0",r.style.border="0",r.style.outline="0",r.style.fontSize="100%",r.style.verticalAlign="baseline",r.style.backgroundColor="transparent",r.style.display="block",r.addEventListener("toggle",(()=>{r.open?this.#a(n,t,a,o):(a.innerHTML="",a.removeAttribute("style"))}));const s=document.createElement("summary");s.innerHTML=`<strong>${i}</strong>`,r.appendChild(s);const o=document.createElement("div");o.className="scroll-container",o.style.overflowY="auto",o.style.maxHeight="700px";const a=document.createElement("div");a.className="viewer",o.appendChild(a),r.appendChild(o),o.addEventListener("scroll",(()=>{this.#a(n,t,a,o)})),this.body.appendChild(r)}return this.body}#t(e,t,n){return this.UICacheRefresh?(this.table?.remove(),n&&(e=Object.keys(t[0])),this.columnWidths=this.#d(t,e),this.table=document.createElement("div"),this.table.className="table",this.#r(this.table),this.table):this.table}#d(e,t){if(t=t.filter((e=>"internal_id"!==e)),"header"===this.config.autoFitCellWidth){const e=t.reduce(((e,t)=>e+t.length),0);this.columnWidths=t.map((t=>t.length/e*100))}else if("content"===this.config.autoFitCellWidth){const n=t.reduce(((t,n)=>t+Math.max(e[n].toString().length,5)),0);this.columnWidths=t.map((t=>Math.max(e[t].toString().length,5)/n*100))}else if("both"===this.config.autoFitCellWidth){const n=t.reduce(((t,n)=>t+Math.max(n.length,5)+Math.max(e[n].toString().length,5)),0);this.columnWidths=t.map((t=>(Math.max(t.length,5)+Math.max(e[t].toString().length,5))/n*100))}else"none"!==this.config.autoFitCellWidth&&this.config.autoFitCellWidth||(this.columnWidths=Array(t.length).fill(100/t.length));return this.columnWidths}#s(e){const t=document.createElement("div");return t.className="row header",t.style.display="grid",t.style.gridTemplateColumns=e.map(((e,t)=>`var(--column-width-${t+1})`)).join(" "),e.forEach(((n,i)=>{const r=(e=>{const t=document.createElement("div");return t.className="cell",t.textContent=e,t})(n);r.title=n,r.setAttribute("value_type",this.dynamicGrid.engine.headers[n]),r.addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation(),this.sortColumn!==n?(this.sortColumn=n,this.sortDirection="asc"):this.sortDirection="asc"===this.sortDirection?"desc":"asc",this.render(this.dynamicGrid.engine.sort(this.sortColumn,this.sortDirection))})),r.addEventListener("contextmenu",(e=>{e.preventDefault(),e.stopPropagation(),this.dynamicGrid.engine.getPlugin(r.getAttribute("value_type")).showMore(r.title,r,this.dynamicGrid)})),i<e.length-1&&r.appendChild(this.#c(i)),t.appendChild(r)})),t}#l(){const e=document.createElement("div");return e.className="row",e.style.display="contents",e}#u(e=""){const t=document.createElement("div");return t.className="cell",t.innerHTML=e,t}#c(e){const t=document.createElement("div");let n,i,r;return t.className="resizer",t.setAttribute("data-index",e),t.addEventListener("mousedown",(s=>{s.preventDefault();const o=t.closest(".table");n=s.clientX,i=this.columnWidths[e],r=this.columnWidths[e+1];const onMouseMove=t=>{const s=(t.clientX-n)/o.offsetWidth*100,a=i+s,l=r-s;a>=this.config.minColumnWidth&&l>=this.config.minColumnWidth&&(this.columnWidths[e]=Number(a.toFixed(2)),this.columnWidths[e+1]=Number(l.toFixed(2)),this.#r(o))},onMouseUp=()=>{document.removeEventListener("mousemove",onMouseMove),document.removeEventListener("mouseup",onMouseUp)};document.addEventListener("mousemove",onMouseMove),document.addEventListener("mouseup",onMouseUp)})),t}#r(e){this.columnWidths.forEach(((t,n)=>{e.style.setProperty(`--column-width-${n+1}`,`${t}%`)}))}}class TypePlugin{static DEFAULT_OPERATORS=["==","!=","in"];constructor(){if(this.constructor===TypePlugin)throw new Error("TypePlugin is abstract and cannot be instantiated directly");this.name=this.constructor.name,this.operators=["==","!=","in"]}validate(e){throw new Error("validate must be implemented by subclass")}evaluate(e,t,n,i){throw new Error("evaluate must be implemented by subclass")}evaluateCondition(e,t,n){throw new Error("evaluateCondition must be implemented by subclass")}sort(e,t){const{field:n,value:i}=e;return[...t].sort(((e,t)=>{const r=String(e[n]).localeCompare(String(t[n]));return"asc"===i?r:-r}))}checkOperator(e){return this.operators.find((t=>t===e))}getOperatorSymbols(){return[...this.operators]}renderHeader(e){const t=document.createElement("th");return t.textContent=e,t}renderCell(e){return String(e)}showMore(e,t,n){const{x:i,y:r}=t.getBoundingClientRect(),s=[{text:"Sort "+e+" ascending",onclick:()=>n.ui.render(n.engine.sort(e,"asc"))},{text:"Sort "+e+" descending",onclick:()=>n.ui.render(n.engine.sort(e,"desc"))},{text:"Unsort "+e,onclick:()=>n.ui.render(n.engine.sort(e,"original"))},null,{text:"Group by "+e,onclick:()=>n.ui.render(n.engine.group(e))},{text:"Un-group",onclick:()=>n.ui.render(n.engine.group())}];new ContextMenu(document.body,s).display(i,r+30)}}class stringTypePlugin extends TypePlugin{constructor(){super(),this.operators=["%=","=%","*=","!*=","==","!=","in"]}validate(e){return"string"==typeof e}evaluate(e,t,n,i){if(t&&i&&t.size<=i.size)for(const n of t.keys())this.evaluateCondition(n,e.operator,e.value)||t.get(n).forEach((e=>i.delete(e)));else for(const t of i)this.evaluateCondition(n[t][e.field],e.operator,e.value)||i.delete(t);return i}evaluateCondition(e,t,n){if("in"===t&&(n=JSON.parse(n)),Array.isArray(n)&&n.length>0&&"in"===t)return n.includes(e);switch(t){case"==":return e===n;case"!=":return e!==n;case"%=":return e.startsWith(n);case"=%":return e.endsWith(n);case"*=":return e.includes(n);case"!*=":return!e.includes(n)}return!1}renderHeader(e){const t=document.createElement("th");return t.innerHTML=e,t}renderCell(e){return String(e)}sort(e,t){const{field:n,value:i}=e;return t.sort(((e,t)=>"asc"===i?e[n].localeCompare(t[n]):"desc"===i?t[n].localeCompare(e[n]):void 0))}}class numberTypePlugin extends TypePlugin{constructor(){super(),this.operators=[">","<",">=","<=","==","!=","in"]}validate(e){return!isNaN(Number(e))}evaluate(e,t,n,i){if(t&&i&&t.size<=i.size)for(const n of t.keys())this.evaluateCondition(n,e.operator,e.value)||t.get(n).forEach((e=>i.delete(e)));else for(const t of i)this.evaluateCondition(n[t][e.field],e.operator,e.value)||i.delete(t);return i}evaluateCondition(e,t,n){if("in"===t&&(n=JSON.parse(n)),Array.isArray(n)&&n.length>0&&"in"===t)return n.includes(e);switch(e=Number(e),n=Number(n),t){case">":return e>n;case"<":return e<n;case">=":return e>=n;case"<=":return e<=n;case"==":return e===n;case"!=":return e!==n}}renderHeader(e){const t=document.createElement("th");return t.innerHTML=e,t}renderCell(e){const t=e.toString().split(".");return t[0]=t[0].replace(/\B(?=(\d{3})+(?!\d))/g,"."),t.join(",")}sort(e,t){const{field:n,value:i}=e;return t.sort(((e,t)=>"asc"===i?e[n]-t[n]:"desc"===i?t[n]-e[n]:void 0))}showMore(e,t,n){const{x:i,y:r}=t.getBoundingClientRect(),s=[{text:"Sort "+e+" ascending",onclick:()=>n.ui.render(n.engine.sort(e,"asc"))},{text:"Sort "+e+" descending",onclick:()=>n.ui.render(n.engine.sort(e,"desc"))},{text:"Unsort "+e,onclick:()=>n.ui.render(n.engine.sort(e,"original"))},null,{text:"Group by "+e,onclick:()=>n.ui.render(n.engine.group(e))},{text:"Un-group",onclick:()=>n.ui.render(n.engine.group())}];new ContextMenu(document.body,s).display(i,r+30)}}class booleanTypePlugin extends TypePlugin{constructor(){super(),this.operators=["==","!="]}validate(e){return!0===(e=Boolean(e))||!1===e}evaluate(e,t,n,i){if(e.value="true"===e.value,t){const n=t.get(e.value);return new Set([...i].filter((e=>n.has(e))))}return new Set(n.map(((t,n)=>t[e.field]===e.value?n:null)).filter((e=>null!==e)))}evaluateCondition(e,t,n){return Boolean(e)===Boolean(n)}sort(e,t){const{field:n,value:i}=e;return t.sort(((e,t)=>"asc"===i?e[n]-t[n]:"desc"===i?t[n]-e[n]:void 0))}renderHeader(e){const t=document.createElement("th");return t.innerHTML=e,t}renderCell(e){const t=document.createElement("input");return t.type="checkbox",e&&t.setAttribute("checked",null),t.disabled=!0,t.style.width="-webkit-fill-available",t.name="checkbox",t.outerHTML}showMore(e,t,n){const{x:i,y:r}=t.getBoundingClientRect(),s=[{text:"Show "+e+" ascending",onclick:()=>n.ui.render(n.engine.sort(e,"asc"))},{text:"Sort "+e+" descending",onclick:()=>n.ui.render(n.engine.sort(e,"desc"))},{text:"Unsort "+e,onclick:()=>n.ui.render(n.engine.sort(e,"original"))},null,{text:"Only show true",onclick:()=>{n.engine.addSelect(e,"==","true"),n.engine.removeSelect(e,"==","false"),n.ui.render(n.engine.runSelect())}},{text:"Only show false",onclick:()=>{n.engine.addSelect(e,"==","false"),n.engine.removeSelect(e,"==","true"),n.ui.render(n.engine.runSelect())}},{text:"Show all",onclick:()=>{n.engine.removeSelect(e,"==","true"),n.engine.removeSelect(e,"==","false"),n.ui.render(n.engine.runSelect())}},null,{text:"Group by "+e,onclick:()=>n.ui.render(n.engine.group(e))},{text:"Un-group",onclick:()=>n.ui.render(n.engine.group())}];new ContextMenu(document.body,s).display(i,r+30)}}class QueryParser{constructor(e){this.config={useStrictCase:e.useStrictCase||!1,SymbolsToIgnore:e.SymbolsToIgnore||[" ","_","-"]}}static QUERIES={GROUP:/group\s+(.+)/i,RANGE:/range\s+(-?\d+)-?(-?\d+)?/i,SORT:/sort\s+(.+)\s+(asc|desc)/i,SELECT:/(.+)\s+(\S+)\s+(.+)/i};parseQuery=(e,t,n)=>e.split(/\s+and\s+|\s+&&\s+/i).map((e=>this.parseSubQuery(e.trim(),t,n))).filter((e=>e.queryType));parseSubQuery(e,t,n){e=e.endsWith(" and")?e.slice(0,-4):e;for(const[i,r]of Object.entries(QueryParser.QUERIES)){const s=r.exec(e);if(s)return this.parseMatch(s,i,t,n)||{}}return console.warn("Invalid query: "+e+"\nValid queries are: "+Object.keys(QueryParser.QUERIES).join(", ").toLowerCase()),{}}parseMatch(e,t,n,i){if("SELECT"===t){let[t,r,s,o]=e;r=MeantIndexKey(Object.keys(i),r,this.config);const a=i[r],l=n[a];if(!l)throw new GridError("No plugin found for header ("+a+") for key ("+r+")\nDo you know certain that the name of the key is correct?");let u=r,d=l.checkOperator(s);if(!d)throw new GridError(this.formatOperatorError(s,u+" "+s+" "+o,l));if(!l.validate(o))return;return{type:a,field:u,operator:d,value:o,queryType:"SELECT"}}if("SORT"===t){let[t,r,s]=e;const o=i[r];if(!n[o])throw new GridError("No plugin found for header ("+o+") for key ("+r+")");return{type:o,field:r,operator:"sort",value:s,queryType:"SORT"}}if("RANGE"===t){let[t,n,i]=e;return void 0===i&&(i=n,n=0),n=parseInt(n),i=parseInt(i),{type:"range",lower:n,upper:i,queryType:"RANGE"}}if("GROUP"===t){let[t,n]=e;return{type:"group",field:n,queryType:"GROUP"}}return console.warn("Invalid query: "+e+"\nValid queries are: "+Object.keys(QueryParser.QUERIES).join(", ").toLowerCase()),{}}formatOperatorError(e,t,n){return["\n\nInvalid operator:    "+e,"       For query:    "+t,"     options are:    "+n.getOperatorSymbols().join(", "),"\n"].join("\n")}}class SJQLEngine{constructor(e){this.data=[],this.headers=[],this.plugins=[],this.currentQueryStr="",this.futureQuery=[],this.QueryParser=new QueryParser(e),this.config={UseDataIndexing:e.UseDataIndexing||!0,useStrictCase:e.useStrictCase||!1,SymbolsToIgnore:e.SymbolsToIgnore||[" ","_","-"]}}createDataIndex(){this.config.UseDataIndexing&&(this.dataIndexes={},Object.keys(this.headers).forEach((e=>{this.dataIndexes[e]=new Map,this.data.forEach(((t,n)=>{const i=t[e];this.dataIndexes[e].has(i)||this.dataIndexes[e].set(i,new Set),this.dataIndexes[e].get(i).add(n)}))})))}autoDetectHeaders(e){for(const t of Object.keys(e))!0===e[t]||!1===e[t]?this.headers[t]="boolean":isNaN(e[t])?this.headers[t]="string":this.headers[t]="number"}query(e=""){return this.data&&0!==this.data.length?e&&""!==e?this.#h(this.QueryParser.parseQuery(e,this.plugins,this.headers)):(console.warn("No query provided, returning all data"),this.currentQueryStr="",this.data):(console.warn("No data provided, returning empty array"),[])}#h(e){if(!e||0===e.length)return this.currentQueryStr="",console.warn("No valid query provided, returning all data"),this.data;const t=[];let n=null,i=null,r=null;for(const s of e)switch(s.queryType){case"SELECT":t.push(s);break;case"SORT":n=s;break;case"RANGE":i=s;break;case"GROUP":r=s}this.currentQueryStr="",t.forEach((e=>this.currentQueryStr+=e.field+" "+e.operator+" "+e.value+" and ")),n&&(this.currentQueryStr+="sort "+n.field+" "+n.value+" and "),i&&(this.currentQueryStr+="range "+i.lower+" "+i.upper+" and "),r&&(this.currentQueryStr+="group "+r.field+" and "),this.currentQueryStr=this.currentQueryStr.slice(0,-5);let s="";t.length>0&&(s+="SELECT queries: "+t.map((e=>e.field+" "+e.operator+" "+e.value)).join(", ")+"\n"),n&&(s+="SORT query: "+n.field+" "+n.value+"\n"),i&&(s+="RANGE query: "+i.lower+" "+i.upper+"\n"),r&&(s+="GROUP query: "+r.field+"\n");let o=new Set(this.data.keys()),a=null;for(const e of t){e.field=MeantIndexKey(Object.keys(this.data[0]),e.field,this.config);const t=this.getPlugin(e.type);if(!t)throw new GridError(`No plugin found for header (${e.type}) for key (${e.field})`);o=t.evaluate(e,this.dataIndexes[e.field],this.data,o)}if(i){const e=o.values().next().value,t=Math.max(0,e+i.lower),n=Math.min(this.data.length-1,e+i.upper-1);o=new Set(Array.from({length:n-t+1},((e,n)=>n+t)))}if(r){const e=MeantIndexKey(Object.keys(this.data[0]),r.field,this.config);a={};for(const t of o){const n=this.data[t],i=n[e];(a[i]||=[]).push(n)}if(n)throw new GridError("Sorting grouped data is not yet supported");return a}if(n){const e=this.data.filter(((e,t)=>o.has(t)));return this.getPlugin(n.type).sort(n,e)}return this.data.filter(((e,t)=>o.has(t)))}sort(e,t){let n="";return 0!==this.currentQueryStr.length||"asc"!==t&&"desc"!==t?"asc"===t||"desc"===t?n=this.currentQueryStr+" and sort "+e+" "+t:t&&""!==t&&"original"!==t||(n=this.currentQueryStr,n=n.replace(QueryParser.QUERIES.SORT,"")):n="sort "+e+" "+t,this.query(n)}group(e=""){let t="";return 0===this.currentQueryStr.length&&Object.keys(this.headers).includes(e)?t="group "+e:this.currentQueryStr.length>0&&Object.keys(this.headers).includes(e)?t=this.currentQueryStr+" and group "+e:e&&""!==e&&"original"!==e||(t=this.currentQueryStr,t=t.replace(QueryParser.QUERIES.GROUP,"")),this.query(t)}addSelect(e,t,n){let i=[];this.currentQueryStr.length>0?(i=this.QueryParser.parseQuery(this.currentQueryStr,this.plugins,this.headers),e&&t&&n&&i.push(this.QueryParser.parseMatch([void 0,e,t,n],"SELECT",this.plugins,this.headers))):i.push(this.QueryParser.parseMatch([void 0,e,t,n],"SELECT",this.plugins,this.headers)),this.futureQuery=i}removeSelect(e,t,n){this.futureQuery=this.futureQuery.filter((i=>!(i.field.toString()===e.toString()&&i.operator.toString()===t.toString()&&i.value.toString()===n.toString())))}runSelect(){return this.#h(this.futureQuery)}addPlugin(e,t=!1){if(!(e instanceof TypePlugin))throw new GridError("Plugin must extend TypePlugin");const n=this.getPlugin(e.name,!0);t&&n||(n&&!t?(console.warn("Plugin already exists, removing the old plugin"),this.plugins[e.name.replace("TypePlugin","")]=e):this.plugins[e.name.replace("TypePlugin","")]=e)}getPlugin(e,t=!1){if(!e)throw new GridError("Plugin name not provided");if("string"!=typeof e)return!1;const n=this.plugins[e.replace("TypePlugin","")];if(!n&&!t)throw new GridError("Plugin not found: "+e);return!(!n&&t)&&n}importData(e,t){if(this.data&&this.data.length>0)throw new GridError("Data already imported, re-importing data is not (yet) supported");if("json"===t.type)this.#m(e,t);else{if("csv"!==t.type)throw new GridError("Invalid data type");this.#p(e,t)}0===Object.keys(this.headers).length&&(console.warn("No headers provided, auto detecting headers, please provide so the system can you more optimal plugins"),this.autoDetectHeaders(this.data[0]))}#m(e,t){if("string"!=typeof e)throw new GridError("Data must be a string (raw JSON)");if(e=JSON.parse(e),!Array.isArray(e))throw new GridError("Data must be an array");if(0===e.length)return console.warn("No data provided"),[];this.data=e.map(((e,t)=>{const n={};n.internal_id=t;for(const t of Object.keys(e))n[t]=e[t];return n}))}#p(e,t){const n=e.split("\n"),i=n[0].split(",").map((e=>e.replace(/"/g,"").replace(" ","_").replace("\r","")));this.data=n.slice(1).map(((e,t)=>{const n=e.split(/(?!"[a-zA-z0-9\s.()]*)(?:,|,"|",)(?![a-zA-z0-9\s.()]*")/gim),r={};return r.internal_id=t,i.forEach(((e,t)=>{"string"==typeof n[t]&&(n[t].endsWith('"')?n[t]=n[t].slice(0,-1):n[t]),r[e]=n[t]})),r})).slice(0,-1)}}class GridError extends Error{constructor(e){super(e),this.name="GridError",this.stack=""}}function FastHash(e){const t=JSON.stringify(e);let n=0;for(let e=0;e<t.length;e++)n=(n<<5)-n+t.charCodeAt(e),n|=0;return n}function MeantIndexKey(e,t,n){return e.find((e=>{let i="",r="";return n.SymbolsToIgnore.length?(i=e.replace(new RegExp(`[${n.SymbolsToIgnore.join("")}]`,"g"),""),r=t.replace(new RegExp(`[${n.SymbolsToIgnore.join("")}]`,"g"),"")):(i=e,r=t),n.useStrictCase||(i=i.toLowerCase(),r=r.toLowerCase()),i===r}))}function firstItem(e){if(!e||"object"!=typeof e)return!1;if(Array.isArray(e))return e[0];return e[Object.keys(e)[0]]}Array.prototype.remove=function(e){const t=this.indexOf(e);return t>-1&&this.splice(t,1),this};class ContextMenu{#g;#y=null;#f=!1;#b=!0;#v=null;#C=[];#w;constructor(e,t){if(!(e&&e instanceof HTMLElement))throw new Error("Invalid container element");this.#g=e,this.#w=t,this.handleOutsideClick=this.handleOutsideClick.bind(this),document.addEventListener("click",this.handleOutsideClick),this.#E()}#E(){if(document.getElementById("context-menu-styles"))return;const e=document.createElement("style");e.id="context-menu-styles",e.textContent="\n.context-menu {\n    display: inline-block;\n    position: fixed;\n    top: 0px;\n    left: 0px;\n    min-width: 270px;\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n    color: #000;\n    background: #f5f5f5;\n    font-size: 9pt;\n    border: 1px solid #333333;\n    box-shadow: 4px 4px 3px -1px rgba(0, 0, 0, 0.5);\n    padding: 3px 0px;\n    -webkit-touch-callout: none;\n    -webkit-user-select: none;\n    -khtml-user-select: none;\n    -moz-user-select: none;\n    -ms-user-select: none;\n    user-select: none;\n}\n\n.context-menu .menu-item {\n    padding: 4px 19px;\n    cursor: default;\n    color: inherit;\n}\n\n.context-menu .menu-item:hover {\n    background: #e3e3e3 !important;\n}\n\n.context-menu .item:hover .menu-hotkey {\n    color: #000 !important;\n}\n\n.context-menu .menu-item-disabled {\n    color: #878B90 !important;\n}\n\n.context-menu .menu-item-disabled:hover {\n    background: inherit !important;\n}\n\n.context-menu .disabled:hover .menu-hotkey {\n    color: #878B90 !important;\n}\n\n.context-menu .menu-separator {\n    margin: 4px 0px;\n    height: 0;\n    padding: 0;\n    border-top: 1px solid #b3b3b3;\n}\n\n.context-menu .menu-hotkey {\n    color: #878B90;\n    float: right;\n}",document.head.appendChild(e)}handleOutsideClick(e){this.#f&&this.#y&&e.target!==this.#y&&!this.#y.contains(e.target)&&!e.target.closest(".context-menu")&&this.#S()}#x(e,t){const n=document.createElement("div");return n.classList.add("context-menu"),n.style.left=`${e}px`,n.style.top=`${t}px`,this.#w.forEach((e=>{n.appendChild(this.#k(e))})),this.#y=n,n}#k(e){if(null===e){const e=document.createElement("div");return e.classList.add("menu-separator"),e}const t=document.createElement("div");t.classList.add("menu-item");const n=document.createElement("span");n.classList.add("menu-label"),n.textContent=e.text?.toString()||"",t.appendChild(n),e.disabled?t.classList.add("menu-item-disabled"):t.classList.add("menu-item-active");const i=document.createElement("span");if(i.classList.add("menu-hotkey"),i.textContent=e.hotkey?.toString()||"",t.appendChild(i),this.#M(e)){const n=e.subitems||e.submenu,i=n instanceof ContextMenuHandler?n:new ContextMenuHandler(this.#g,n);i.#b=!1,i.#v=this,this.#C.push(i),t.classList.add("has-submenu");const openSubMenu=()=>{if(e.disabled)return;this.#T();const n=this.#y.offsetLeft+this.#y.clientWidth+t.offsetLeft,r=this.#y.offsetTop+t.offsetTop;i.#f?i.#I():i.#R(n,r)};t.addEventListener("click",openSubMenu),t.addEventListener("mousemove",openSubMenu)}else t.addEventListener("click",(()=>{if(this.#T(),!t.classList.contains("menu-item-disabled"))if("function"==typeof e.onclick){const r={handled:!1,item:t,label:n,hotkey:i,items:this.#w,data:e};e.onclick(r),r.handled||this.#I()}else this.#I()})),t.addEventListener("mousemove",(()=>{this.#T()}));return t}#M(e){return e.subitems&&Array.isArray(e.subitems)&&e.subitems.length>0||e.submenu&&e.submenu instanceof ContextMenuHandler}#S(){!this.#b||this.#v?this.#v.#I():this.#f&&(this.#T(),this.#f=!1,this.#g.removeChild(this.#y),this.#v&&this.#v.#f&&this.#v.#I())}#I(){this.#y&&this.#f&&(this.#f=!1,this.#T(),this.#g.removeChild(this.#y),this.#v&&this.#v.#f&&this.#v.#I()),this.#L()}#T(){this.#C.forEach((e=>{e.#f&&(e.#f=!1,e.#g.removeChild(e.#y)),e.#T()}))}#R(e,t){this.#x(e,t),this.#g.appendChild(this.#y),setTimeout((()=>{this.#f=!0}),0)}#L(){this.#y=null,document.removeEventListener("click",this.handleOutsideClick)}display(e,t){return document.querySelectorAll(".context-menu").forEach((e=>e.remove())),this.#R(e,t),this}dismiss(){return this.#I(),this}getMenuState(){return{container:this.#g,domElement:this.#y,isVisible:this.#f,isRootMenu:this.#b,parentMenu:this.#v,childMenus:this.#C,menuItems:this.#w}}}
//# sourceMappingURL=./Compiled/DynamicGrid.min.js.map